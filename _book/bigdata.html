<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Computing for Big Data (BST-262)</title>
  <meta name="description" content="Class notes for BST 262">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Computing for Big Data (BST-262)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Class notes for BST 262" />
  <meta name="github-repo" content="cchoirat/bigdata17" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Computing for Big Data (BST-262)" />
  
  <meta name="twitter:description" content="Class notes for BST 262" />
  

<meta name="author" content="Christine Choirat">


<meta name="date" content="2017-11-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="databases.html">
<link rel="next" href="visualization.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computing for Big Data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#logistics"><i class="fa fa-check"></i><b>1.1</b> Logistics</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#prerequisites"><i class="fa fa-check"></i><b>1.2</b> Prerequisites</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#rationale"><i class="fa fa-check"></i><b>1.3</b> Rationale</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#big-data-bottlenecks"><i class="fa fa-check"></i><b>1.4</b> Big data bottlenecks</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#syllabus"><i class="fa fa-check"></i><b>1.5</b> Syllabus</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#evaluation"><i class="fa fa-check"></i><b>1.6</b> Evaluation</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#software-tools-and-packages"><i class="fa fa-check"></i><b>1.7</b> Software tools and packages</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#datasets"><i class="fa fa-check"></i><b>1.8</b> Datasets</a><ul>
<li class="chapter" data-level="1.8.1" data-path="intro.html"><a href="intro.html#movielens"><i class="fa fa-check"></i><b>1.8.1</b> MovieLens</a></li>
<li class="chapter" data-level="1.8.2" data-path="intro.html"><a href="intro.html#airlines-data"><i class="fa fa-check"></i><b>1.8.2</b> Airlines data</a></li>
<li class="chapter" data-level="1.8.3" data-path="intro.html"><a href="intro.html#insurance-claims"><i class="fa fa-check"></i><b>1.8.3</b> Insurance claims</a></li>
<li class="chapter" data-level="1.8.4" data-path="intro.html"><a href="intro.html#census"><i class="fa fa-check"></i><b>1.8.4</b> Census</a></li>
<li class="chapter" data-level="1.8.5" data-path="intro.html"><a href="intro.html#pm2.5-exposure"><i class="fa fa-check"></i><b>1.8.5</b> PM<sub>2.5</sub> exposure</a></li>
<li class="chapter" data-level="1.8.6" data-path="intro.html"><a href="intro.html#methylation"><i class="fa fa-check"></i><b>1.8.6</b> Methylation</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#contributing-with-github"><i class="fa fa-check"></i><b>1.9</b> Contributing with GitHub</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#before-we-start"><i class="fa fa-check"></i><b>1.10</b> Before we start…</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#style"><i class="fa fa-check"></i><b>1.11</b> Style</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basic tools</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#command-line-tools"><i class="fa fa-check"></i><b>2.1</b> Command line tools</a><ul>
<li class="chapter" data-level="2.1.1" data-path="basics.html"><a href="basics.html#why-use-the-command-line"><i class="fa fa-check"></i><b>2.1.1</b> Why use the command line?</a></li>
<li class="chapter" data-level="2.1.2" data-path="basics.html"><a href="basics.html#basic-unix-tools"><i class="fa fa-check"></i><b>2.1.2</b> Basic Unix tools</a></li>
<li class="chapter" data-level="2.1.3" data-path="basics.html"><a href="basics.html#useful-tools"><i class="fa fa-check"></i><b>2.1.3</b> Useful tools</a></li>
<li class="chapter" data-level="2.1.4" data-path="basics.html"><a href="basics.html#example"><i class="fa fa-check"></i><b>2.1.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#makefiles"><i class="fa fa-check"></i><b>2.2</b> Makefiles</a><ul>
<li class="chapter" data-level="2.2.1" data-path="basics.html"><a href="basics.html#simulate-data-in-r"><i class="fa fa-check"></i><b>2.2.1</b> Simulate data in R</a></li>
<li class="chapter" data-level="2.2.2" data-path="basics.html"><a href="basics.html#create-a-plot-in-python"><i class="fa fa-check"></i><b>2.2.2</b> Create a plot in Python</a></li>
<li class="chapter" data-level="2.2.3" data-path="basics.html"><a href="basics.html#run-statistical-model-in-r"><i class="fa fa-check"></i><b>2.2.3</b> Run statistical model in R</a></li>
<li class="chapter" data-level="2.2.4" data-path="basics.html"><a href="basics.html#run-statistical-model-in-r-1"><i class="fa fa-check"></i><b>2.2.4</b> Run statistical model in R</a></li>
<li class="chapter" data-level="2.2.5" data-path="basics.html"><a href="basics.html#makefile-syntax"><i class="fa fa-check"></i><b>2.2.5</b> Makefile syntax</a></li>
<li class="chapter" data-level="2.2.6" data-path="basics.html"><a href="basics.html#naive-version"><i class="fa fa-check"></i><b>2.2.6</b> Naive version</a></li>
<li class="chapter" data-level="2.2.7" data-path="basics.html"><a href="basics.html#making-all-targets"><i class="fa fa-check"></i><b>2.2.7</b> Making all targets</a></li>
<li class="chapter" data-level="2.2.8" data-path="basics.html"><a href="basics.html#dealing-with-dependencies"><i class="fa fa-check"></i><b>2.2.8</b> Dealing with dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#git-and-github"><i class="fa fa-check"></i><b>2.3</b> Git and GitHub</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>3</b> Packages</a><ul>
<li class="chapter" data-level="3.1" data-path="packages.html"><a href="packages.html#why"><i class="fa fa-check"></i><b>3.1</b> Why?</a></li>
<li class="chapter" data-level="3.2" data-path="packages.html"><a href="packages.html#package-structure"><i class="fa fa-check"></i><b>3.2</b> Package structure</a></li>
<li class="chapter" data-level="3.3" data-path="packages.html"><a href="packages.html#building-steps"><i class="fa fa-check"></i><b>3.3</b> Building steps</a><ul>
<li class="chapter" data-level="3.3.1" data-path="packages.html"><a href="packages.html#r-cmd-build"><i class="fa fa-check"></i><b>3.3.1</b> <code>R CMD build</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="packages.html"><a href="packages.html#r-cmd-install"><i class="fa fa-check"></i><b>3.3.2</b> <code>R CMD INSTALL</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="packages.html"><a href="packages.html#r-cmd-check"><i class="fa fa-check"></i><b>3.3.3</b> <code>R CMD check</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="packages.html"><a href="packages.html#building-steps-with-devtools"><i class="fa fa-check"></i><b>3.3.4</b> Building steps with <code>devtools</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="packages.html"><a href="packages.html#create-an-r-package"><i class="fa fa-check"></i><b>3.4</b> Create an R package</a><ul>
<li class="chapter" data-level="3.4.1" data-path="packages.html"><a href="packages.html#utilspackage.skeleton"><i class="fa fa-check"></i><b>3.4.1</b> <code>utils::package.skeleton</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="packages.html"><a href="packages.html#devtoolscreate"><i class="fa fa-check"></i><b>3.4.2</b> <code>devtools::create</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="packages.html"><a href="packages.html#submit-to-cran"><i class="fa fa-check"></i><b>3.4.3</b> Submit to CRAN</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="packages.html"><a href="packages.html#r-packages-on-github"><i class="fa fa-check"></i><b>3.5</b> R packages on GitHub</a><ul>
<li class="chapter" data-level="3.5.1" data-path="packages.html"><a href="packages.html#gitignore"><i class="fa fa-check"></i><b>3.5.1</b> <code>.gitignore</code></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="packages.html"><a href="packages.html#rstudio-projects"><i class="fa fa-check"></i><b>3.6</b> RStudio projects</a><ul>
<li class="chapter" data-level="3.6.1" data-path="packages.html"><a href="packages.html#project-options"><i class="fa fa-check"></i><b>3.6.1</b> Project options</a></li>
<li class="chapter" data-level="3.6.2" data-path="packages.html"><a href="packages.html#package-documentation"><i class="fa fa-check"></i><b>3.6.2</b> Package documentation</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="packages.html"><a href="packages.html#package-workflow-example"><i class="fa fa-check"></i><b>3.7</b> Package workflow example</a><ul>
<li class="chapter" data-level="3.7.1" data-path="packages.html"><a href="packages.html#add-linreg.r-to-r-directory"><i class="fa fa-check"></i><b>3.7.1</b> Add <code>linreg.R</code> to <code>R/</code> directory</a></li>
<li class="chapter" data-level="3.7.2" data-path="packages.html"><a href="packages.html#run-our-function"><i class="fa fa-check"></i><b>3.7.2</b> Run our function</a></li>
<li class="chapter" data-level="3.7.3" data-path="packages.html"><a href="packages.html#add-roxygen2-documentation"><i class="fa fa-check"></i><b>3.7.3</b> Add ROxygen2 documentation</a></li>
<li class="chapter" data-level="3.7.4" data-path="packages.html"><a href="packages.html#configure-build-tools"><i class="fa fa-check"></i><b>3.7.4</b> Configure Build Tools</a></li>
<li class="chapter" data-level="3.7.5" data-path="packages.html"><a href="packages.html#man-page"><i class="fa fa-check"></i><b>3.7.5</b> <code>man</code> page</a></li>
<li class="chapter" data-level="3.7.6" data-path="packages.html"><a href="packages.html#formatted-output"><i class="fa fa-check"></i><b>3.7.6</b> Formatted output</a></li>
<li class="chapter" data-level="3.7.7" data-path="packages.html"><a href="packages.html#description"><i class="fa fa-check"></i><b>3.7.7</b> <code>DESCRIPTION</code></a></li>
<li class="chapter" data-level="3.7.8" data-path="packages.html"><a href="packages.html#namespace"><i class="fa fa-check"></i><b>3.7.8</b> <code>NAMESPACE</code></a></li>
<li class="chapter" data-level="3.7.9" data-path="packages.html"><a href="packages.html#s3-basics"><i class="fa fa-check"></i><b>3.7.9</b> S3 basics</a></li>
<li class="chapter" data-level="3.7.10" data-path="packages.html"><a href="packages.html#s3-and-s4-generics"><i class="fa fa-check"></i><b>3.7.10</b> S3 and S4 generics</a></li>
<li class="chapter" data-level="3.7.11" data-path="packages.html"><a href="packages.html#print"><i class="fa fa-check"></i><b>3.7.11</b> <code>print</code></a></li>
<li class="chapter" data-level="3.7.12" data-path="packages.html"><a href="packages.html#other-methods"><i class="fa fa-check"></i><b>3.7.12</b> Other methods</a></li>
<li class="chapter" data-level="3.7.13" data-path="packages.html"><a href="packages.html#formulas-and-model-frames"><i class="fa fa-check"></i><b>3.7.13</b> Formulas and model frames</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="packages.html"><a href="packages.html#unit-testing"><i class="fa fa-check"></i><b>3.8</b> Unit testing</a><ul>
<li class="chapter" data-level="3.8.1" data-path="packages.html"><a href="packages.html#unit-tests-and-testthat"><i class="fa fa-check"></i><b>3.8.1</b> Unit tests and <code>testthat</code></a></li>
<li class="chapter" data-level="3.8.2" data-path="packages.html"><a href="packages.html#test_coef.r"><i class="fa fa-check"></i><b>3.8.2</b> <code>test_coef.R</code></a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="packages.html"><a href="packages.html#continuous-integration"><i class="fa fa-check"></i><b>3.9</b> Continuous integration</a></li>
<li class="chapter" data-level="3.10" data-path="packages.html"><a href="packages.html#code-coverage"><i class="fa fa-check"></i><b>3.10</b> Code coverage</a></li>
<li class="chapter" data-level="3.11" data-path="packages.html"><a href="packages.html#back-to-github"><i class="fa fa-check"></i><b>3.11</b> Back to GitHub</a></li>
<li class="chapter" data-level="3.12" data-path="packages.html"><a href="packages.html#vignettes"><i class="fa fa-check"></i><b>3.12</b> Vignettes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>4</b> Optimization</a><ul>
<li class="chapter" data-level="4.1" data-path="optimization.html"><a href="optimization.html#measuring-performance"><i class="fa fa-check"></i><b>4.1</b> Measuring performance</a><ul>
<li class="chapter" data-level="4.1.1" data-path="optimization.html"><a href="optimization.html#benchmarking"><i class="fa fa-check"></i><b>4.1.1</b> Benchmarking</a></li>
<li class="chapter" data-level="4.1.2" data-path="optimization.html"><a href="optimization.html#profiling-and-optimization"><i class="fa fa-check"></i><b>4.1.2</b> Profiling and optimization</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="optimization.html"><a href="optimization.html#improving-performance"><i class="fa fa-check"></i><b>4.2</b> Improving performance</a></li>
<li class="chapter" data-level="4.3" data-path="optimization.html"><a href="optimization.html#vectorization"><i class="fa fa-check"></i><b>4.3</b> Vectorization</a></li>
<li class="chapter" data-level="4.4" data-path="optimization.html"><a href="optimization.html#parallelization"><i class="fa fa-check"></i><b>4.4</b> Parallelization</a></li>
<li class="chapter" data-level="4.5" data-path="optimization.html"><a href="optimization.html#introduction-to-c"><i class="fa fa-check"></i><b>4.5</b> Introduction to C++</a><ul>
<li class="chapter" data-level="4.5.1" data-path="optimization.html"><a href="optimization.html#rcpp"><i class="fa fa-check"></i><b>4.5.1</b> Rcpp</a></li>
<li class="chapter" data-level="4.5.2" data-path="optimization.html"><a href="optimization.html#hello-world"><i class="fa fa-check"></i><b>4.5.2</b> Hello World!</a></li>
<li class="chapter" data-level="4.5.3" data-path="optimization.html"><a href="optimization.html#sourcecpp"><i class="fa fa-check"></i><b>4.5.3</b> <code>sourceCpp</code></a></li>
<li class="chapter" data-level="4.5.4" data-path="optimization.html"><a href="optimization.html#data-types"><i class="fa fa-check"></i><b>4.5.4</b> Data types</a></li>
<li class="chapter" data-level="4.5.5" data-path="optimization.html"><a href="optimization.html#sugar"><i class="fa fa-check"></i><b>4.5.5</b> Sugar</a></li>
<li class="chapter" data-level="4.5.6" data-path="optimization.html"><a href="optimization.html#example-continued"><i class="fa fa-check"></i><b>4.5.6</b> Example (continued)</a></li>
<li class="chapter" data-level="4.5.7" data-path="optimization.html"><a href="optimization.html#back-to-linreg"><i class="fa fa-check"></i><b>4.5.7</b> Back to Linreg</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="optimization.html"><a href="optimization.html#rcpp-packages"><i class="fa fa-check"></i><b>4.6</b> Rcpp packages</a></li>
<li class="chapter" data-level="4.7" data-path="optimization.html"><a href="optimization.html#getting-serious-about-c"><i class="fa fa-check"></i><b>4.7</b> Getting serious about C++</a><ul>
<li class="chapter" data-level="4.7.1" data-path="optimization.html"><a href="optimization.html#stl"><i class="fa fa-check"></i><b>4.7.1</b> STL</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="optimization.html"><a href="optimization.html#profiling"><i class="fa fa-check"></i><b>4.8</b> Profiling</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="databases.html"><a href="databases.html"><i class="fa fa-check"></i><b>5</b> SQL</a><ul>
<li class="chapter" data-level="5.1" data-path="databases.html"><a href="databases.html#what-is-sql"><i class="fa fa-check"></i><b>5.1</b> What is SQL?</a><ul>
<li class="chapter" data-level="5.1.1" data-path="databases.html"><a href="databases.html#what-is-a-database"><i class="fa fa-check"></i><b>5.1.1</b> What is a database?</a></li>
<li class="chapter" data-level="5.1.2" data-path="databases.html"><a href="databases.html#relational-databases-sql"><i class="fa fa-check"></i><b>5.1.2</b> Relational Databases (SQL)</a></li>
<li class="chapter" data-level="5.1.3" data-path="databases.html"><a href="databases.html#types-of-relational-databases"><i class="fa fa-check"></i><b>5.1.3</b> Types of Relational Databases</a></li>
<li class="chapter" data-level="5.1.4" data-path="databases.html"><a href="databases.html#sql"><i class="fa fa-check"></i><b>5.1.4</b> SQL</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="databases.html"><a href="databases.html#sqlite-an-exercise"><i class="fa fa-check"></i><b>5.2</b> SQLite: An Exercise</a><ul>
<li class="chapter" data-level="5.2.1" data-path="databases.html"><a href="databases.html#make-a-table"><i class="fa fa-check"></i><b>5.2.1</b> Make a Table</a></li>
<li class="chapter" data-level="5.2.2" data-path="databases.html"><a href="databases.html#insert-values"><i class="fa fa-check"></i><b>5.2.2</b> Insert Values</a></li>
<li class="chapter" data-level="5.2.3" data-path="databases.html"><a href="databases.html#select-values"><i class="fa fa-check"></i><b>5.2.3</b> Select Values</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="databases.html"><a href="databases.html#sql-and-r"><i class="fa fa-check"></i><b>5.3</b> SQL and R</a><ul>
<li class="chapter" data-level="5.3.1" data-path="databases.html"><a href="databases.html#data-oscars-and-movies-again-2016-oscars-nominations"><i class="fa fa-check"></i><b>5.3.1</b> Data: <code>oscars</code> and <code>movies</code> again: 2016 Oscars Nominations</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="databases.html"><a href="databases.html#non-relational-databases-nosql"><i class="fa fa-check"></i><b>5.4</b> Non-Relational Databases (noSQL)</a><ul>
<li class="chapter" data-level="5.4.1" data-path="databases.html"><a href="databases.html#drawbacks-of-relational-databases"><i class="fa fa-check"></i><b>5.4.1</b> Drawbacks of Relational Databases</a></li>
<li class="chapter" data-level="5.4.2" data-path="databases.html"><a href="databases.html#common-types-of-nosql-databases"><i class="fa fa-check"></i><b>5.4.2</b> Common Types of NoSQL Databases</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="databases.html"><a href="databases.html#references"><i class="fa fa-check"></i><b>5.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bigdata.html"><a href="bigdata.html"><i class="fa fa-check"></i><b>6</b> Big data</a><ul>
<li class="chapter" data-level="6.1" data-path="bigdata.html"><a href="bigdata.html#how-to-deal-with-very-too-large-datasets"><i class="fa fa-check"></i><b>6.1</b> How to deal with (very / too) large datasets?</a></li>
<li class="chapter" data-level="6.2" data-path="bigdata.html"><a href="bigdata.html#how-big-is-big"><i class="fa fa-check"></i><b>6.2</b> How big is big?</a></li>
<li class="chapter" data-level="6.3" data-path="bigdata.html"><a href="bigdata.html#list-of-tools"><i class="fa fa-check"></i><b>6.3</b> List of tools</a></li>
<li class="chapter" data-level="6.4" data-path="bigdata.html"><a href="bigdata.html#data-that-fits-in-memory"><i class="fa fa-check"></i><b>6.4</b> Data that fits in memory</a><ul>
<li class="chapter" data-level="6.4.1" data-path="bigdata.html"><a href="bigdata.html#faster-io"><i class="fa fa-check"></i><b>6.4.1</b> Faster I/O</a></li>
<li class="chapter" data-level="6.4.2" data-path="bigdata.html"><a href="bigdata.html#reference-vs-copy"><i class="fa fa-check"></i><b>6.4.2</b> Reference vs copy</a></li>
<li class="chapter" data-level="6.4.3" data-path="bigdata.html"><a href="bigdata.html#data.table-another-data-manipulation-grammar"><i class="fa fa-check"></i><b>6.4.3</b> data.table: another data manipulation grammar</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="bigdata.html"><a href="bigdata.html#data-that-doesnt-fit-in-memory-but-fits-on-drive"><i class="fa fa-check"></i><b>6.5</b> Data that doesn’t fit in memory (but fits on drive)</a></li>
<li class="chapter" data-level="6.6" data-path="bigdata.html"><a href="bigdata.html#pure-r-solutions"><i class="fa fa-check"></i><b>6.6</b> Pure R solutions</a><ul>
<li class="chapter" data-level="6.6.1" data-path="bigdata.html"><a href="bigdata.html#a-regressions-example"><i class="fa fa-check"></i><b>6.6.1</b> A regressions example</a></li>
<li class="chapter" data-level="6.6.2" data-path="bigdata.html"><a href="bigdata.html#sampling"><i class="fa fa-check"></i><b>6.6.2</b> Sampling</a></li>
<li class="chapter" data-level="6.6.3" data-path="bigdata.html"><a href="bigdata.html#bigmemory"><i class="fa fa-check"></i><b>6.6.3</b> <code>bigmemory</code></a></li>
<li class="chapter" data-level="6.6.4" data-path="bigdata.html"><a href="bigdata.html#database-connections-and-lazy-evaluation"><i class="fa fa-check"></i><b>6.6.4</b> Database connections and lazy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="bigdata.html"><a href="bigdata.html#scaling-up"><i class="fa fa-check"></i><b>6.7</b> Scaling up</a></li>
<li class="chapter" data-level="6.8" data-path="bigdata.html"><a href="bigdata.html#parallel-computing-and-clusters"><i class="fa fa-check"></i><b>6.8</b> Parallel computing and clusters</a></li>
<li class="chapter" data-level="6.9" data-path="bigdata.html"><a href="bigdata.html#cloud-computing"><i class="fa fa-check"></i><b>6.9</b> Cloud computing</a></li>
<li class="chapter" data-level="6.10" data-path="bigdata.html"><a href="bigdata.html#h2o-fast-scalable-machine-learning"><i class="fa fa-check"></i><b>6.10</b> <code>h2o</code>: “Fast Scalable Machine Learning”</a><ul>
<li class="chapter" data-level="6.10.1" data-path="bigdata.html"><a href="bigdata.html#ecosystem"><i class="fa fa-check"></i><b>6.10.1</b> Ecosystem</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="bigdata.html"><a href="bigdata.html#running-h20-locally-within-r"><i class="fa fa-check"></i><b>6.11</b> Running h20 locally within R</a></li>
<li class="chapter" data-level="6.12" data-path="bigdata.html"><a href="bigdata.html#jvm-from-wikipedia"><i class="fa fa-check"></i><b>6.12</b> JVM (from Wikipedia)</a></li>
<li class="chapter" data-level="6.13" data-path="bigdata.html"><a href="bigdata.html#which-languages-from-wikipedia"><i class="fa fa-check"></i><b>6.13</b> Which languages? (from Wikipedia)</a></li>
<li class="chapter" data-level="6.14" data-path="bigdata.html"><a href="bigdata.html#which-languages"><i class="fa fa-check"></i><b>6.14</b> Which languages?</a></li>
<li class="chapter" data-level="6.15" data-path="bigdata.html"><a href="bigdata.html#state-of-the-h2o-jvm"><i class="fa fa-check"></i><b>6.15</b> State of the h2o JVM</a><ul>
<li class="chapter" data-level="6.15.1" data-path="bigdata.html"><a href="bigdata.html#importing-data-into-h2o-from-the-r-session"><i class="fa fa-check"></i><b>6.15.1</b> Importing data into h2o from the R session</a></li>
<li class="chapter" data-level="6.15.2" data-path="bigdata.html"><a href="bigdata.html#h2o-functions"><i class="fa fa-check"></i><b>6.15.2</b> h2o functions</a></li>
<li class="chapter" data-level="6.15.3" data-path="bigdata.html"><a href="bigdata.html#lets-check-from-the-h2o-jvm"><i class="fa fa-check"></i><b>6.15.3</b> Let’s check from the h2o JVM</a></li>
<li class="chapter" data-level="6.15.4" data-path="bigdata.html"><a href="bigdata.html#importing-data-into-h2o-from-disk"><i class="fa fa-check"></i><b>6.15.4</b> Importing data into h2o from disk</a></li>
<li class="chapter" data-level="6.15.5" data-path="bigdata.html"><a href="bigdata.html#running-a-statistical-model"><i class="fa fa-check"></i><b>6.15.5</b> Running a statistical model</a></li>
<li class="chapter" data-level="6.15.6" data-path="bigdata.html"><a href="bigdata.html#h2o-models"><i class="fa fa-check"></i><b>6.15.6</b> <code>h2o</code> models</a></li>
<li class="chapter" data-level="6.15.7" data-path="bigdata.html"><a href="bigdata.html#closing-the-h2o-session"><i class="fa fa-check"></i><b>6.15.7</b> Closing the h2o session</a></li>
<li class="chapter" data-level="6.15.8" data-path="bigdata.html"><a href="bigdata.html#available-algorithms"><i class="fa fa-check"></i><b>6.15.8</b> Available algorithms</a></li>
<li class="chapter" data-level="6.15.9" data-path="bigdata.html"><a href="bigdata.html#how-to-incorporate-new-models-in-h2o"><i class="fa fa-check"></i><b>6.15.9</b> How to incorporate new models in h2o?</a></li>
</ul></li>
<li class="chapter" data-level="6.16" data-path="bigdata.html"><a href="bigdata.html#spark"><i class="fa fa-check"></i><b>6.16</b> Spark</a><ul>
<li class="chapter" data-level="6.16.1" data-path="bigdata.html"><a href="bigdata.html#run-a-statistical-model"><i class="fa fa-check"></i><b>6.16.1</b> Run a statistical model</a></li>
<li class="chapter" data-level="6.16.2" data-path="bigdata.html"><a href="bigdata.html#deployment"><i class="fa fa-check"></i><b>6.16.2</b> Deployment</a></li>
</ul></li>
<li class="chapter" data-level="6.17" data-path="bigdata.html"><a href="bigdata.html#sparkling-water"><i class="fa fa-check"></i><b>6.17</b> <code>Sparkling Water</code></a></li>
<li class="chapter" data-level="6.18" data-path="bigdata.html"><a href="bigdata.html#adding-new-models-to-h2o-and-spark"><i class="fa fa-check"></i><b>6.18</b> Adding new models to <code>h2o</code> and <code>spark</code></a></li>
<li class="chapter" data-level="6.19" data-path="bigdata.html"><a href="bigdata.html#more"><i class="fa fa-check"></i><b>6.19</b> More?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>7</b> Visualization</a><ul>
<li class="chapter" data-level="7.1" data-path="visualization.html"><a href="visualization.html#principles-of-visualization"><i class="fa fa-check"></i><b>7.1</b> Principles of visualization</a></li>
<li class="chapter" data-level="7.2" data-path="visualization.html"><a href="visualization.html#maps-and-gis"><i class="fa fa-check"></i><b>7.2</b> Maps and GIS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computing for Big Data (BST-262)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bigdata" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Big data</h1>
<div id="how-to-deal-with-very-too-large-datasets" class="section level2">
<h2><span class="header-section-number">6.1</span> How to deal with (very / too) large datasets?</h2>
<ol style="list-style-type: decimal">
<li>Use more RAM / processors / drive space…</li>
<li>Use less data: (re)sample, …</li>
<li>Use a database</li>
<li>Use specific R packages (<code>ff</code>, <code>bigmemory</code>)</li>
<li>Use other tools</li>
</ol>
</div>
<div id="how-big-is-big" class="section level2">
<h2><span class="header-section-number">6.2</span> How big is big?</h2>
<ol style="list-style-type: decimal">
<li>Fits in RAM and on drive (but slow)</li>
<li>Doesn’t fit in RAM but fits on drive</li>
<li>Doesn’t fit in RAM and doesn’t fit on drive</li>
</ol>
</div>
<div id="list-of-tools" class="section level2">
<h2><span class="header-section-number">6.3</span> List of tools</h2>
<p>Reading: <span class="citation">Varian (<a href="#ref-Varian2014">2014</a>)</span> (<a href="http://pubs.aeaweb.org/doi/pdfplus/10.1257/jep.28.2.3">PDF available</a>)</p>
<p><img src="images/ch6_tool_list.png" width="374" style="display: block; margin: auto;" /></p>
<p>Spark? h2o? More? Let’s go back to the bottlenecks</p>
<ul>
<li>CPU</li>
<li>RAM</li>
<li>I/O</li>
</ul>
</div>
<div id="data-that-fits-in-memory" class="section level2">
<h2><span class="header-section-number">6.4</span> Data that fits in memory</h2>
<div id="faster-io" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Faster I/O</h3>
<p>Reading: <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a></p>
<p><code>data.table</code> provides an enhanced of a <code>data.frame</code> and faster I/O with <code>fread</code> and <code>fwrite</code>.</p>
<p>To read the 0.5GB ratings file from MovieLens</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
<span class="kw">system.time</span>(ratings &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;~/Dropbox/Data17/ml-20m/ratings.csv&quot;</span>))</code></pre></div>
<p>takes</p>
<pre class="txt"><code>Read 20000263 rows and 4 (of 4) columns from 0.497 GB file in 00:00:05
   user  system elapsed 
  4.007   0.229   4.244</code></pre>
<p>while</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(ratings &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/Dropbox/Data17/ml-20m/ratings.csv&quot;</span>))</code></pre></div>
<p>takes</p>
<pre class="txt"><code>   user  system elapsed 
 85.199   2.711  90.997 </code></pre>
<p>There are ways to improve the speed of <code>read.csv</code> (for example, but specifying column types). But in general <code>fread</code> is much faster.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr) <span class="co"># in tidyverse</span>
<span class="kw">system.time</span>(ratings &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;~/Dropbox/Data17/ml-20m/ratings.csv&quot;</span>))</code></pre></div>
<pre class="txt"><code>   user  system elapsed 
 10.290   3.037  18.450 </code></pre>
<p>also tends to perform better than <code>read.csv</code>.</p>
<table>
<caption><span id="tab:unnamed-chunk-108">Table 6.1: </span>I/O comparison</caption>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">function.</th>
<th align="left">speed</th>
<th align="left">output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">base</td>
<td align="left">read.csv</td>
<td align="left">slow</td>
<td align="left">data.frame</td>
</tr>
<tr class="even">
<td align="left">data.table</td>
<td align="left">fread</td>
<td align="left">very fast</td>
<td align="left">data.table</td>
</tr>
<tr class="odd">
<td align="left">readr</td>
<td align="left">read_csv</td>
<td align="left">fast</td>
<td align="left">tibble</td>
</tr>
</tbody>
</table>
</div>
<div id="reference-vs-copy" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Reference vs copy</h3>
<p>Reading: <a href="http://adv-r.had.co.nz/memory.html" class="uri">http://adv-r.had.co.nz/memory.html</a> Reading: <a href="https://jangorecki.gitlab.io/data.table/library/data.table/html/assign.html" class="uri">https://jangorecki.gitlab.io/data.table/library/data.table/html/assign.html</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pryr)
<span class="kw">library</span>(data.table)

d &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/Dropbox/Data17/ml-latest-small/ratings.csv&quot;</span>)
D &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;~/Dropbox/Data17/ml-latest-small/ratings.csv&quot;</span>)

<span class="kw">object_size</span>(d)
<span class="kw">object_size</span>(D)

<span class="kw">mem_change</span>(d<span class="op">$</span>Idx &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(d))
<span class="kw">mem_change</span>(D[, Idx<span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>.N])

<span class="kw">object_size</span>(d<span class="op">$</span>Idx)
<span class="kw">object_size</span>(D<span class="op">$</span>Idx)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/Dropbox/Data17/ml-latest-small/ratings.csv&quot;</span>)
D &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;~/Dropbox/Data17/ml-latest-small/ratings.csv&quot;</span>)

<span class="kw">.Internal</span>(<span class="kw">inspect</span>(d))
d<span class="op">$</span>Idx &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(d)
<span class="kw">.Internal</span>(<span class="kw">inspect</span>(d))

<span class="kw">.Internal</span>(<span class="kw">inspect</span>(D))
D[, Idx<span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span>.N]
<span class="kw">.Internal</span>(<span class="kw">inspect</span>(D))</code></pre></div>
</div>
<div id="data.table-another-data-manipulation-grammar" class="section level3">
<h3><span class="header-section-number">6.4.3</span> data.table: another data manipulation grammar</h3>
<p>Reading: <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a></p>

<div class="exercise">
<span id="exr:unnamed-chunk-111" class="exercise"><strong>Exercise 6.1  </strong></span>Benchmark adding a column to a large data frame vs a large data table.
</div>

</div>
</div>
<div id="data-that-doesnt-fit-in-memory-but-fits-on-drive" class="section level2">
<h2><span class="header-section-number">6.5</span> Data that doesn’t fit in memory (but fits on drive)</h2>
<p>Let’s try to work with a 12GB file and 4/8 GB of memory…</p>
</div>
<div id="pure-r-solutions" class="section level2">
<h2><span class="header-section-number">6.6</span> Pure R solutions</h2>
<div id="a-regressions-example" class="section level3">
<h3><span class="header-section-number">6.6.1</span> A regressions example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
airlines &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;/Users/cchoirat/Dropbox/Data17/AirFlights/allyears2k.csv&quot;</span>)
rfit &lt;-<span class="st"> </span><span class="kw">lm</span>(ArrDelay <span class="op">~</span><span class="st"> </span>Distance, <span class="dt">data =</span> airlines)
<span class="kw">summary</span>(rfit)</code></pre></div>
</div>
<div id="sampling" class="section level3">
<h3><span class="header-section-number">6.6.2</span> Sampling</h3>
<ul>
<li>Read the data (even line by line)</li>
<li>Select a sample of rows</li>
<li>Run your model on the random sample</li>
</ul>
</div>
<div id="bigmemory" class="section level3">
<h3><span class="header-section-number">6.6.3</span> <code>bigmemory</code></h3>
<p><a href="https://cran.r-project.org/web/packages/bigmemory/index.html" class="uri">https://cran.r-project.org/web/packages/bigmemory/index.html</a></p>
<p>Reading: <a href="https://cran.r-project.org/web/packages/bigmemory/vignettes/Overview.pdf" class="uri">https://cran.r-project.org/web/packages/bigmemory/vignettes/Overview.pdf</a></p>
<p><strong>bigmemory</strong>: Manage Massive Matrices with Shared Memory and Memory-Mapped Files</p>
<p>Create, store, access, and manipulate massive matrices. Matrices are allocated to shared memory and may use memory-mapped files. Packages ‘biganalytics’, ‘bigtabulate’, ‘synchronicity’, and ‘bigalgebra’ provide advanced functionality.</p>
<p><strong>(+)</strong> pure R solution from a user perspective</p>
<p><strong>(-)</strong> mostly for numeric data matrices, mostly to speed up computations on data of +/- RAM size</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bigmemory)
<span class="kw">library</span>(biganalytics)
<span class="co"># library(bigtabulate)</span>
<span class="co"># library(biglm)</span>

flights &lt;-<span class="st"> </span><span class="kw">read.big.matrix</span>(
  <span class="st">&quot;/Users/cchoirat/Dropbox/Data17/AirFlights/allyears2k.csv&quot;</span>,
  <span class="dt">header =</span> <span class="ot">TRUE</span>,
  <span class="dt">backingfile =</span> <span class="st">&quot;allyears2k.bin&quot;</span>,
  <span class="dt">backingpath =</span> <span class="st">&quot;/Users/cchoirat/Dropbox/Data17/AirFlights/&quot;</span>,
  <span class="dt">descriptorfile =</span> <span class="st">&quot;allyears2k.desc&quot;</span>,
  <span class="dt">shared =</span> <span class="ot">TRUE</span>)

air_flights &lt;-<span class="st"> </span><span class="kw">attach.big.matrix</span>(<span class="st">&quot;/Users/cchoirat/Dropbox/Data17/AirFlights/allyears2k.desc&quot;</span>)
<span class="kw">dim</span>(air_flights)
<span class="kw">colnames</span>(air_flights)
<span class="kw">mean</span>(air_flights[, <span class="st">&quot;ArrDelay&quot;</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

fit &lt;-<span class="st"> </span><span class="kw">biglm.big.matrix</span>(ArrDelay <span class="op">~</span><span class="st"> </span>Distance, <span class="dt">data =</span> air_flights)
fit
<span class="kw">summary</span>(fit)</code></pre></div>
</div>
<div id="database-connections-and-lazy-evaluation" class="section level3">
<h3><span class="header-section-number">6.6.4</span> Database connections and lazy evaluation</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
D &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;~/Dropbox/Data17/ml-20m/ratings.csv&quot;</span>)

<span class="kw">library</span>(sqldf)
<span class="kw">read.csv.sql</span>(<span class="dt">file =</span> <span class="st">&quot;~/Dropbox/Data17/ml-20m/ratings.csv&quot;</span>,
             <span class="dt">sql =</span> <span class="kw">c</span>(<span class="st">&quot;ATTACH &#39;ratings.sqlite3&#39; AS NEW&quot;</span>))
<span class="kw">read.csv.sql</span>(<span class="dt">file =</span> <span class="st">&quot;~/Dropbox/Data17/ml-20m/ratings.csv&quot;</span>,
             <span class="dt">sql =</span> <span class="st">&quot;CREATE TABLE ratings_table AS SELECT * FROM file&quot;</span>,
             <span class="dt">dbname =</span> <span class="st">&quot;ratings.sqlite3&quot;</span>)

<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(DBI)

con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(RSQLite<span class="op">::</span><span class="kw">SQLite</span>(), <span class="dt">dbname =</span> <span class="st">&quot;ratings.sqlite3&quot;</span>)

ratings_db &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="st">&quot;ratings_table&quot;</span>)
ratings_db <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;Id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(movieId <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Source:   lazy query [?? x 2]</span>
<span class="co"># Database: sqlite 3.19.3</span>
<span class="co">#   [/Users/cchoirat/Documents/LocalGit/bigdata17/ratings.sqlite3]</span>
   userId movieId
    <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span>
<span class="st"> </span><span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">2</span>
 <span class="dv">2</span>      <span class="dv">1</span>      <span class="dv">29</span>
 <span class="dv">3</span>      <span class="dv">1</span>      <span class="dv">32</span>
 <span class="dv">4</span>      <span class="dv">1</span>      <span class="dv">47</span>
 <span class="dv">5</span>      <span class="dv">1</span>      <span class="dv">50</span>
 <span class="dv">6</span>      <span class="dv">2</span>       <span class="dv">3</span>
 <span class="dv">7</span>      <span class="dv">2</span>      <span class="dv">62</span>
 <span class="dv">8</span>      <span class="dv">2</span>      <span class="dv">70</span>
 <span class="dv">9</span>      <span class="dv">3</span>       <span class="dv">1</span>
<span class="dv">10</span>      <span class="dv">3</span>      <span class="dv">24</span>
<span class="co"># ... with more rows</span>
<span class="co"># ... with more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ratings_db <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;Id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(movieId <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">collect</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># A tibble: 790,226 x 2</span>
   userId movieId
    <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>int<span class="op">&gt;</span>
<span class="st"> </span><span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">2</span>
 <span class="dv">2</span>      <span class="dv">1</span>      <span class="dv">29</span>
 <span class="dv">3</span>      <span class="dv">1</span>      <span class="dv">32</span>
 <span class="dv">4</span>      <span class="dv">1</span>      <span class="dv">47</span>
 <span class="dv">5</span>      <span class="dv">1</span>      <span class="dv">50</span>
 <span class="dv">6</span>      <span class="dv">2</span>       <span class="dv">3</span>
 <span class="dv">7</span>      <span class="dv">2</span>      <span class="dv">62</span>
 <span class="dv">8</span>      <span class="dv">2</span>      <span class="dv">70</span>
 <span class="dv">9</span>      <span class="dv">3</span>       <span class="dv">1</span>
<span class="dv">10</span>      <span class="dv">3</span>      <span class="dv">24</span>
<span class="co"># ... with 790,216 more rows</span></code></pre></div>
</div>
</div>
<div id="scaling-up" class="section level2">
<h2><span class="header-section-number">6.7</span> Scaling up</h2>
</div>
<div id="parallel-computing-and-clusters" class="section level2">
<h2><span class="header-section-number">6.8</span> Parallel computing and clusters</h2>
</div>
<div id="cloud-computing" class="section level2">
<h2><span class="header-section-number">6.9</span> Cloud computing</h2>
<p>More soon with the Odyssey guest lecture (<a href="https://www.rc.fas.harvard.edu/odyssey/" class="uri">https://www.rc.fas.harvard.edu/odyssey/</a>).</p>
</div>
<div id="h2o-fast-scalable-machine-learning" class="section level2">
<h2><span class="header-section-number">6.10</span> <code>h2o</code>: “Fast Scalable Machine Learning”</h2>
<p><a href="http://www.h2o.ai/" class="uri">http://www.h2o.ai/</a></p>
<p><a href="http://www.r-bloggers.com/scalable-machine-learning-for-big-data-using-r-and-h2o/" class="uri">http://www.r-bloggers.com/scalable-machine-learning-for-big-data-using-r-and-h2o/</a></p>
<p><a href="http://venturebeat.com/2014/11/07/h2o-funding/" class="uri">http://venturebeat.com/2014/11/07/h2o-funding/</a> <a href="https://www.h2o.ai/driverless-ai/" class="uri">https://www.h2o.ai/driverless-ai/</a> <a href="https://www.infoworld.com/article/3236048/machine-learning/review-h2oai-automates-machine-learning.html" class="uri">https://www.infoworld.com/article/3236048/machine-learning/review-h2oai-automates-machine-learning.html</a></p>
<div id="ecosystem" class="section level3">
<h3><span class="header-section-number">6.10.1</span> Ecosystem</h3>
<p>Readings:</p>
<ul>
<li><p><a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/welcome.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/welcome.html</a></p></li>
<li><p><a href="http://www.h2o.ai/download/h2o/r" class="uri">http://www.h2o.ai/download/h2o/r</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/h2o/index.html" class="uri">https://cran.r-project.org/web/packages/h2o/index.html</a></p></li>
</ul>
<blockquote>
<p>To build H2O or run H2O tests, the 64-bit JDK is required.</p>
<p>To run the H2O binary using either the command line, R, or Python packages, only 64-bit JRE is required.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="st">&quot;package:h2o&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">search</span>()) { <span class="kw">detach</span>(<span class="st">&quot;package:h2o&quot;</span>, <span class="dt">unload=</span><span class="ot">TRUE</span>) }
<span class="cf">if</span> (<span class="st">&quot;h2o&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(<span class="kw">installed.packages</span>())) { <span class="kw">remove.packages</span>(<span class="st">&quot;h2o&quot;</span>) }
<span class="kw">install.packages</span>(<span class="st">&quot;h2o&quot;</span>)</code></pre></div>
</div>
</div>
<div id="running-h20-locally-within-r" class="section level2">
<h2><span class="header-section-number">6.11</span> Running h20 locally within R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(h2o)
localH2O &lt;-<span class="st"> </span><span class="kw">h2o.init</span>(<span class="dt">min_mem_size =</span> <span class="st">&quot;20g&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># h2o.init(ip = &quot;localhost&quot;, port = 54321, startH2O = TRUE,</span>
<span class="co">#          forceDL = FALSE, enable_assertions = TRUE, license = NULL,</span>
<span class="co">#          nthreads = -2, max_mem_size = NULL, min_mem_size = NULL,</span>
<span class="co">#          ice_root = tempdir(), strict_version_check = TRUE,</span>
<span class="co">#          proxy = NA_character_, https = FALSE, insecure = FALSE,</span>
<span class="co">#          username = NA_character_, password = NA_character_)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> Connection successful<span class="op">!</span>

R is connected to the H2O cluster<span class="op">:</span><span class="st"> </span>
<span class="st">    </span>H2O cluster uptime<span class="op">:</span><span class="st">         </span><span class="dv">19</span> days <span class="dv">12</span> hours 
    H2O cluster version<span class="op">:</span><span class="st">        </span><span class="fl">3.14</span>.<span class="fl">0.3</span> 
    H2O cluster version age<span class="op">:</span><span class="st">    </span><span class="dv">1</span> month and <span class="dv">24</span> days  
    H2O cluster name<span class="op">:</span><span class="st">           </span>H2O_started_from_R_cchoirat_bgt310 
    H2O cluster total nodes<span class="op">:</span><span class="st">    </span><span class="dv">1</span> 
    H2O cluster total memory<span class="op">:</span><span class="st">   </span><span class="fl">15.18</span> GB 
    H2O cluster total cores<span class="op">:</span><span class="st">    </span><span class="dv">8</span> 
    H2O cluster allowed cores<span class="op">:</span><span class="st">  </span><span class="dv">8</span> 
    H2O cluster healthy<span class="op">:</span><span class="st">        </span><span class="ot">TRUE</span> 
    H2O Connection ip<span class="op">:</span><span class="st">          </span>localhost 
    H2O Connection port<span class="op">:</span><span class="st">        </span><span class="dv">54321</span> 
    H2O Connection proxy<span class="op">:</span><span class="st">       </span><span class="ot">NA</span> 
    H2O Internal Security<span class="op">:</span><span class="st">      </span><span class="ot">FALSE</span> 
    H2O API Extensions<span class="op">:</span><span class="st">         </span>XGBoost, Algos, AutoML, Core V3, Core V4 
    R Version<span class="op">:</span><span class="st">                  </span>R version <span class="fl">3.4</span>.<span class="dv">2</span> (<span class="dv">2017</span><span class="op">-</span><span class="dv">09</span><span class="op">-</span><span class="dv">28</span>) </code></pre></div>
</div>
<div id="jvm-from-wikipedia" class="section level2">
<h2><span class="header-section-number">6.12</span> JVM (from Wikipedia)</h2>
<p>A Java virtual machine (JVM) is an abstract computing machine that enables a computer to run a Java program. There are three notions of the JVM: specification, implementation, and instance. The specification is a document that formally describes what is required of a JVM implementation.</p>
<p>(<a href="https://en.wikipedia.org/wiki/Java_virtual_machine" class="uri">https://en.wikipedia.org/wiki/Java_virtual_machine</a>)</p>
</div>
<div id="which-languages-from-wikipedia" class="section level2">
<h2><span class="header-section-number">6.13</span> Which languages? (from Wikipedia)</h2>
<p>This list of JVM Languages comprises notable computer programming languages that are used to produce software that runs on the Java Virtual Machine (JVM). Some of these languages are interpreted by a Java program, and some are compiled to Java bytecode and JIT-compiled during execution as regular Java programs to improve performance.</p>
</div>
<div id="which-languages" class="section level2">
<h2><span class="header-section-number">6.14</span> Which languages?</h2>
<p><a href="https://en.wikipedia.org/wiki/List_of_JVM_languages" class="uri">https://en.wikipedia.org/wiki/List_of_JVM_languages</a></p>
<ul>
<li>Java</li>
<li>Scala, an object-oriented and functional programming language</li>
<li>Jython</li>
<li>R (an implementation of R: <a href="https://en.wikipedia.org/wiki/Renjin" class="uri">https://en.wikipedia.org/wiki/Renjin</a>)</li>
<li>…</li>
</ul>
</div>
<div id="state-of-the-h2o-jvm" class="section level2">
<h2><span class="header-section-number">6.15</span> State of the h2o JVM</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.clusterInfo</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">R is connected to the H2O cluster<span class="op">:</span><span class="st"> </span>
<span class="st">    </span>H2O cluster uptime<span class="op">:</span><span class="st">         </span><span class="dv">19</span> days <span class="dv">13</span> hours 
    H2O cluster version<span class="op">:</span><span class="st">        </span><span class="fl">3.14</span>.<span class="fl">0.3</span> 
    H2O cluster version age<span class="op">:</span><span class="st">    </span><span class="dv">1</span> month and <span class="dv">24</span> days  
    H2O cluster name<span class="op">:</span><span class="st">           </span>H2O_started_from_R_cchoirat_bgt310 
    H2O cluster total nodes<span class="op">:</span><span class="st">    </span><span class="dv">1</span> 
    H2O cluster total memory<span class="op">:</span><span class="st">   </span><span class="fl">15.18</span> GB 
    H2O cluster total cores<span class="op">:</span><span class="st">    </span><span class="dv">8</span> 
    H2O cluster allowed cores<span class="op">:</span><span class="st">  </span><span class="dv">8</span> 
    H2O cluster healthy<span class="op">:</span><span class="st">        </span><span class="ot">TRUE</span> 
    H2O Connection ip<span class="op">:</span><span class="st">          </span>localhost 
    H2O Connection port<span class="op">:</span><span class="st">        </span><span class="dv">54321</span> 
    H2O Connection proxy<span class="op">:</span><span class="st">       </span><span class="ot">NA</span> 
    H2O Internal Security<span class="op">:</span><span class="st">      </span><span class="ot">FALSE</span> 
    H2O API Extensions<span class="op">:</span><span class="st">         </span>XGBoost, Algos, AutoML, Core V3, Core V4 
    R Version<span class="op">:</span><span class="st">                  </span>R version <span class="fl">3.4</span>.<span class="dv">2</span> (<span class="dv">2017</span><span class="op">-</span><span class="dv">09</span><span class="op">-</span><span class="dv">28</span>) </code></pre></div>
<p>Let’s check <a href="http://localhost:54321/flow/index.html" class="uri">http://localhost:54321/flow/index.html</a>.</p>
<p><img src="images/ch6_h2o_flow.png" width="1407" style="display: block; margin: auto;" /></p>
<div id="importing-data-into-h2o-from-the-r-session" class="section level3">
<h3><span class="header-section-number">6.15.1</span> Importing data into h2o from the R session</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(cars)
cars_to_h2o &lt;-<span class="st"> </span><span class="kw">as.h2o</span>(cars, <span class="dt">destination_frame =</span> <span class="st">&quot;cars_from_r&quot;</span>)
<span class="kw">is.data.frame</span>(cars_to_h2o) <span class="co"># FALSE</span>
<span class="kw">class</span>(cars_to_h2o) <span class="co"># H2OFrame</span></code></pre></div>
<p>(No persistence beyond the R session when h2O is started from R.)</p>
</div>
<div id="h2o-functions" class="section level3">
<h3><span class="header-section-number">6.15.2</span> h2o functions</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(cars_to_h2o) <span class="co"># actually calls h2o:::summary.H2OFrame(cars_to_h2o)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Approximated quantiles computed<span class="op">!</span><span class="st"> </span>If you are interested <span class="cf">in</span> exact quantiles, please pass the <span class="st">`</span><span class="dt">exact_quantiles=TRUE</span><span class="st">`</span> parameter. speed          dist            
 Min.   <span class="op">:</span><span class="st"> </span><span class="fl">4.0</span>   Min.   <span class="op">:</span><span class="st">  </span><span class="fl">2.00</span>  
 1st Qu.<span class="op">:</span><span class="fl">12.0</span>   1st Qu.<span class="op">:</span><span class="st"> </span><span class="fl">26.00</span>  
 Median <span class="op">:</span><span class="fl">15.0</span>   Median <span class="op">:</span><span class="st"> </span><span class="fl">36.00</span>  
 Mean   <span class="op">:</span><span class="fl">15.4</span>   Mean   <span class="op">:</span><span class="st"> </span><span class="fl">42.98</span>  
 3rd Qu.<span class="op">:</span><span class="fl">19.0</span>   3rd Qu.<span class="op">:</span><span class="st"> </span><span class="fl">56.00</span>  
 Max.   <span class="op">:</span><span class="fl">25.0</span>   Max.   <span class="op">:</span><span class="fl">120.00</span>  </code></pre></div>
</div>
<div id="lets-check-from-the-h2o-jvm" class="section level3">
<h3><span class="header-section-number">6.15.3</span> Let’s check from the h2o JVM</h3>
<p>From the browser: ‘Data’ -&gt; ‘List All Frames’</p>
<p><img src="images/ch6_h2o_list_data.png" width="1023" style="display: block; margin: auto;" /></p>
</div>
<div id="importing-data-into-h2o-from-disk" class="section level3">
<h3><span class="header-section-number">6.15.4</span> Importing data into h2o from disk</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airlines_path &lt;-<span class="st"> &quot;/Users/cchoirat/Dropbox/Data17/AirFlights/allyears2k.csv&quot;</span> <span class="co"># full path</span>
airlines_to_h2o &lt;-<span class="st"> </span><span class="kw">h2o.importFile</span>(<span class="dt">path =</span> airlines_path,
                                  <span class="dt">destination_frame =</span> <span class="st">&quot;airlines_from_r&quot;</span>)
<span class="kw">summary</span>(airlines_to_h2o)</code></pre></div>
</div>
<div id="running-a-statistical-model" class="section level3">
<h3><span class="header-section-number">6.15.5</span> Running a statistical model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2ofit &lt;-<span class="st"> </span><span class="kw">h2o.glm</span>(<span class="dt">y =</span> <span class="st">&quot;ArrDelay&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Distance&quot;</span>,
                  <span class="dt">training_frame =</span> airlines_to_h2o,
                  <span class="dt">intercept =</span> <span class="ot">TRUE</span>, <span class="co"># default is TRUE</span>
                  <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>)
h2ofit
<span class="kw">summary</span>(h2ofit)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Coefficients<span class="op">:</span><span class="st"> </span>glm coefficients
      names coefficients standardized_coefficients
<span class="dv">1</span> Intercept     <span class="fl">7.702657</span>                  <span class="fl">9.308665</span>
<span class="dv">2</span>  Distance     <span class="fl">0.002199</span>                  <span class="fl">1.272253</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airlines &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/Dropbox/Data17/AirFlights/allyears2k.csv&quot;</span>)
rfit &lt;-<span class="st"> </span><span class="kw">lm</span>(ArrDelay <span class="op">~</span><span class="st"> </span>Distance, <span class="dt">data =</span> airlines)
<span class="kw">summary</span>(rfit)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Coefficients<span class="op">:</span>
<span class="st">             </span>Estimate Std. Error t value <span class="kw">Pr</span>(<span class="op">&gt;</span><span class="er">|</span>t<span class="op">|</span>)    
(Intercept) <span class="fl">7.7011553</span>  <span class="fl">0.2326198</span>  <span class="fl">33.106</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span>
Distance    <span class="fl">0.0022045</span>  <span class="fl">0.0002487</span>   <span class="fl">8.865</span>   <span class="op">&lt;</span><span class="fl">2e-16</span> <span class="op">**</span><span class="er">*</span></code></pre></div>
</div>
<div id="h2o-models" class="section level3">
<h3><span class="header-section-number">6.15.6</span> <code>h2o</code> models</h3>
<p><img src="images/ch6_h2o_models.png" width="990" style="display: block; margin: auto;" /></p>
</div>
<div id="closing-the-h2o-session" class="section level3">
<h3><span class="header-section-number">6.15.7</span> Closing the h2o session</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">h2o.shutdown</span>()</code></pre></div>
</div>
<div id="available-algorithms" class="section level3">
<h3><span class="header-section-number">6.15.8</span> Available algorithms</h3>
<ul>
<li>Deep learning</li>
<li>Distributed randon forest</li>
<li>Gradient boosting method</li>
<li>Generalized linear modeling</li>
<li>Generalized low rank modeling</li>
<li>K-means</li>
<li>Naive Bayes</li>
<li>Principal component analysis</li>
</ul>
</div>
<div id="how-to-incorporate-new-models-in-h2o" class="section level3">
<h3><span class="header-section-number">6.15.9</span> How to incorporate new models in h2o?</h3>
<p><strong>(+)</strong> built-in models behave very much like R and are scalable</p>
<p><strong>(-)</strong> not easy to extend (<em>e.g</em>., GLM <a href="https://github.com/h2oai/h2o-3/blob/master/h2o-algos/src/main/java/hex/glm/GLM.java" class="uri">https://github.com/h2oai/h2o-3/blob/master/h2o-algos/src/main/java/hex/glm/GLM.java</a>)</p>

<div class="exercise">
<span id="exr:unnamed-chunk-133" class="exercise"><strong>Exercise 6.2  </strong></span>Run the same analysis with the whole dataset <code>allyears.csv</code>.
</div>

</div>
</div>
<div id="spark" class="section level2">
<h2><span class="header-section-number">6.16</span> Spark</h2>
<p>Reading: <a href="https://spark.rstudio.com/" class="uri">https://spark.rstudio.com/</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sparklyr)
<span class="kw">spark_install</span>(<span class="dt">version =</span> <span class="st">&quot;2.1.0&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conf &lt;-<span class="st"> </span><span class="kw">spark_config</span>()
conf<span class="op">$</span><span class="st">`</span><span class="dt">sparklyr.shell.driver-memory</span><span class="st">`</span> &lt;-<span class="st"> &quot;32G&quot;</span>
conf<span class="op">$</span>spark.memory.fraction &lt;-<span class="st"> </span><span class="fl">0.5</span>
sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
iris_tbl &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, iris)
flights_tbl &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, nycflights13<span class="op">::</span>flights, <span class="st">&quot;flights&quot;</span>)
batting_tbl &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, Lahman<span class="op">::</span>Batting, <span class="st">&quot;batting&quot;</span>)
<span class="kw">src_tbls</span>(sc)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[<span class="dv">1</span>] <span class="st">&quot;batting&quot;</span> <span class="st">&quot;flights&quot;</span> <span class="st">&quot;iris&quot;</span></code></pre></div>
<p>You can use SQL:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(DBI)
iris_preview &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(sc, <span class="st">&quot;SELECT * FROM iris LIMIT 10&quot;</span>)</code></pre></div>
<p>Like h2o, you can open a web interface:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spark_web</span>(sc)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">top_rows &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;~/Dropbox/Data17/AirFlights/allyears.csv&quot;</span>, <span class="dt">nrows =</span> <span class="dv">5</span>)
file_columns &lt;-<span class="st"> </span>top_rows <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="cf">function</span>(x)<span class="st">&quot;character&quot;</span>)
<span class="kw">rm</span>(top_rows)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp_flights &lt;-<span class="st"> </span><span class="kw">spark_read_csv</span>(sc, 
                             <span class="dt">name =</span> <span class="st">&quot;flights2&quot;</span>, 
                             <span class="dt">path =</span> <span class="st">&quot;~/Dropbox/Data17/AirFlights/allyears.csv&quot;</span>, 
                             <span class="dt">memory =</span> <span class="ot">FALSE</span>, 
                             <span class="dt">columns =</span> file_columns, 
                             <span class="dt">infer_schema =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Source:   table&lt;flights2&gt; [?? x 31]</span>
<span class="co"># Database: spark_connection</span>
    Year Month DayofMonth DayOfWeek DepTime CRSDepTime ArrTime CRSArrTime UniqueCarrier
   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">     </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">      </span><span class="er">&lt;</span>chr<span class="op">&gt;</span><span class="st">         </span><span class="er">&lt;</span>chr<span class="op">&gt;</span>
<span class="st"> </span><span class="dv">1</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">14</span>         <span class="dv">3</span>     <span class="dv">741</span>        <span class="dv">730</span>     <span class="dv">912</span>        <span class="dv">849</span>            PS
 <span class="dv">2</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">15</span>         <span class="dv">4</span>     <span class="dv">729</span>        <span class="dv">730</span>     <span class="dv">903</span>        <span class="dv">849</span>            PS
 <span class="dv">3</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">17</span>         <span class="dv">6</span>     <span class="dv">741</span>        <span class="dv">730</span>     <span class="dv">918</span>        <span class="dv">849</span>            PS
 <span class="dv">4</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">18</span>         <span class="dv">7</span>     <span class="dv">729</span>        <span class="dv">730</span>     <span class="dv">847</span>        <span class="dv">849</span>            PS
 <span class="dv">5</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">19</span>         <span class="dv">1</span>     <span class="dv">749</span>        <span class="dv">730</span>     <span class="dv">922</span>        <span class="dv">849</span>            PS
 <span class="dv">6</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">21</span>         <span class="dv">3</span>     <span class="dv">728</span>        <span class="dv">730</span>     <span class="dv">848</span>        <span class="dv">849</span>            PS
 <span class="dv">7</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">22</span>         <span class="dv">4</span>     <span class="dv">728</span>        <span class="dv">730</span>     <span class="dv">852</span>        <span class="dv">849</span>            PS
 <span class="dv">8</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">23</span>         <span class="dv">5</span>     <span class="dv">731</span>        <span class="dv">730</span>     <span class="dv">902</span>        <span class="dv">849</span>            PS
 <span class="dv">9</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">24</span>         <span class="dv">6</span>     <span class="dv">744</span>        <span class="dv">730</span>     <span class="dv">908</span>        <span class="dv">849</span>            PS
<span class="dv">10</span>  <span class="dv">1987</span>    <span class="dv">10</span>         <span class="dv">25</span>         <span class="dv">7</span>     <span class="dv">729</span>        <span class="dv">730</span>     <span class="dv">851</span>        <span class="dv">849</span>            PS
<span class="co"># ... with more rows, and 22 more variables: FlightNum &lt;chr&gt;, TailNum &lt;chr&gt;,</span>
<span class="co">#   ActualElapsedTime &lt;chr&gt;, CRSElapsedTime &lt;chr&gt;, AirTime &lt;chr&gt;, ArrDelay &lt;chr&gt;,</span>
<span class="co">#   DepDelay &lt;chr&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;, Distance &lt;chr&gt;, TaxiIn &lt;chr&gt;,</span>
<span class="co">#   TaxiOut &lt;chr&gt;, Cancelled &lt;chr&gt;, CancellationCode &lt;chr&gt;, Diverted &lt;chr&gt;,</span>
<span class="co">#   CarrierDelay &lt;chr&gt;, WeatherDelay &lt;chr&gt;, NASDelay &lt;chr&gt;, SecurityDelay &lt;chr&gt;,</span>
<span class="co">#   LateAircraftDelay &lt;chr&gt;, IsArrDelayed &lt;chr&gt;, IsDepDelayed &lt;chr&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_table &lt;-<span class="st"> </span>sp_flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DepDelay =</span> <span class="kw">as.numeric</span>(DepDelay),
         <span class="dt">ArrDelay =</span> <span class="kw">as.numeric</span>(ArrDelay),
         <span class="dt">Distance =</span> <span class="kw">as.numeric</span>(Distance),
         <span class="dt">SchedDeparture =</span> <span class="kw">as.numeric</span>(CRSDepTime)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Origin, Dest, SchedDeparture, ArrDelay, DepDelay, Month, DayofMonth, Distance)

flights_table <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<p>Cache data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp_flights <span class="op">%&gt;%</span>
<span class="st">  </span>tally <span class="co"># takes a looooong time</span></code></pre></div>
<p>123534969…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># might take a while...</span>
subset_table &lt;-<span class="st"> </span>flights_table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">compute</span>(<span class="st">&quot;flights_subset&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subset_table <span class="op">%&gt;%</span>
<span class="st">  </span>tally <span class="co"># a bit faster.</span></code></pre></div>
<p>123534969 as well!</p>
<div id="run-a-statistical-model" class="section level3">
<h3><span class="header-section-number">6.16.1</span> Run a statistical model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># small_flights &lt;- spark_read_csv(sc, </span>
<span class="co">#                              name = &quot;flights2&quot;, </span>
<span class="co">#                              path = &quot;~/Dropbox/Data17/AirFlights/allyears2k.csv&quot;, </span>
<span class="co">#                              memory = FALSE, </span>
<span class="co">#                              columns = file_columns, </span>
<span class="co">#                              infer_schema = FALSE)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># small_flights_table &lt;- small_flights %&gt;%</span>
<span class="co">#   mutate(DepDelay = as.numeric(DepDelay),</span>
<span class="co">#          ArrDelay = as.numeric(ArrDelay),</span>
<span class="co">#          Distance = as.numeric(Distance),</span>
<span class="co">#          SchedDeparture = as.numeric(CRSDepTime)) %&gt;%</span>
<span class="co">#   select(Origin, Dest, SchedDeparture, ArrDelay, DepDelay, Month, DayofMonth, Distance)</span>
<span class="co"># </span>
<span class="co"># small_flights_table %&gt;% head</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># lm(arr_delay ~ distance, data = flights_tbl)</span>
 <span class="kw">ml_linear_regression</span>(flights_table, <span class="dt">response =</span> <span class="st">&quot;ArrDelay&quot;</span>, <span class="dt">features =</span> <span class="st">&quot;Distance&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Coefficients<span class="op">:</span>
<span class="st"> </span>(Intercept)     Distance 
<span class="fl">6.9707048955</span> <span class="fl">0.0001100521</span></code></pre></div>
<p><img src="images/ch6_spark_jobs.png" width="1420" style="display: block; margin: auto;" /></p>
</div>
<div id="deployment" class="section level3">
<h3><span class="header-section-number">6.16.2</span> Deployment</h3>
<p>Reading: <a href="https://spark.rstudio.com/deployment.html" class="uri">https://spark.rstudio.com/deployment.html</a></p>
</div>
</div>
<div id="sparkling-water" class="section level2">
<h2><span class="header-section-number">6.17</span> <code>Sparkling Water</code></h2>
<p>Reading: <a href="https://spark.rstudio.com/h2o.html" class="uri">https://spark.rstudio.com/h2o.html</a></p>
</div>
<div id="adding-new-models-to-h2o-and-spark" class="section level2">
<h2><span class="header-section-number">6.18</span> Adding new models to <code>h2o</code> and <code>spark</code></h2>
</div>
<div id="more" class="section level2">
<h2><span class="header-section-number">6.19</span> More?</h2>
<p>GPU</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Varian2014">
<p>Varian, H.R. 2014. “Big Data: New Tricks for Econometrics.” <em>Journal of Economic Perspectives</em> 28 (2): 3–28. doi:<a href="https://doi.org/10.1257/jep.28.2.3">10.1257/jep.28.2.3</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="databases.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cchoirat/bigdata17edit/master/06-bigdata.Rmd",
"text": "Edit"
},
"download": ["Computing for Big Data.pdf", "Computing for Big Data.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
