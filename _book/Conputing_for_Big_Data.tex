\documentclass[]{book}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Computing for Big Data (BST-262)},
            pdfauthor={Christine Choirat},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{natbib}
\bibliographystyle{apalike}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Computing for Big Data (BST-262)}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{Christine Choirat}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{2017-10-16}

\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\usepackage{amsthm}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}{Lemma}[chapter]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{corollary}{Corollary}[chapter]
\newtheorem{proposition}{Proposition}[chapter]
\theoremstyle{definition}
\newtheorem{example}{Example}[chapter]
\theoremstyle{definition}
\newtheorem{exercise}{Exercise}[chapter]
\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newtheorem*{solution}{Solution}
\let\BeginKnitrBlock\begin \let\EndKnitrBlock\end
\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\chapter{Introduction}\label{intro}

\section{Logistics}\label{logistics}

\begin{itemize}
\tightlist
\item
  Fall 2 course
\item
  Tuesday and Wednesday, 11:30am-1pm
\item
  Contact info:
  \href{mailto:cchoirat@iq.harvard.edu}{\nolinkurl{cchoirat@iq.harvard.edu}}.
  Please use BST232 in the email title.
\item
  TA's: Qian Di
  (\href{mailto:qiandi@mail.harvard.edu}{\nolinkurl{qiandi@mail.harvard.edu}})
  and Ben Sabath
  (\href{mailto:mbsabath@hsph.harvard.edu}{\nolinkurl{mbsabath@hsph.harvard.edu}})
\item
  Office hours: TBD
\item
  Course GitHub repository \url{https://github.com/cchoirat/bigdata17}
\item
  Open file in folder \texttt{\_book/index.html}
\end{itemize}

\section{Prerequisites}\label{prerequisites}

For BST262 (Computing for Big Data), we assume familiarity with the
material covered in BST260 (Introduction to Data Science).

We will use R to present concepts that are mostly language-agnostic. We
could have used Python, as in BST261 (Data Science II).

\section{Rationale}\label{rationale}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Available data grows at a much faster rate than available computing
  capacity.
\item
  Statistical software programs such as R were not designed to handle
  datasets of massive size.
\end{enumerate}

\section{Big data bottlenecks}\label{big-data-bottlenecks}

As described by \citet{Lim2015}, there are three bottlenecks:

\begin{itemize}
\tightlist
\item
  CPU
\item
  RAM
\item
  I/O
\end{itemize}

\begin{figure}

{\centering \includegraphics{images/ch1_bottlenecks} 

}

\caption{Steps to execute an R program, from @Lim2015, Chapter 1.}\label{fig:bottlenecks}
\end{figure}

\BeginKnitrBlock{exercise}
\protect\hypertarget{exr:unnamed-chunk-1}{}{\label{exr:unnamed-chunk-1} }Can
you identify points 1--7 in the following code snippet?
\EndKnitrBlock{exercise}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"mydata.csv"}\NormalTok{)}
\NormalTok{totals <-}\StringTok{ }\KeywordTok{colSums}\NormalTok{(data)}
\KeywordTok{write.csv}\NormalTok{(totals, }\StringTok{"totals.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Syllabus}\label{syllabus}

Week 1 - Basic tools

\begin{itemize}
\tightlist
\item
  Lecture 1. Unix scripting, make
\item
  Lecture 2. Version control: Git and GitHub (guest lecture: Ista Zhan)
\end{itemize}

Week 2 - Creating and maintaining R packages

\begin{itemize}
\tightlist
\item
  Lecture 3. Rationale, package structure, available tools
\item
  Lecture 4. Basics of software engineering: unit testing, code
  coverage, continuous integration
\end{itemize}

Week 3 - Software optimization

\begin{itemize}
\tightlist
\item
  Lecture 5. Measuring performance: profiling and benchmarking tools
\item
  Lecture 6. Improving performance: an introduction to C/C++, Rcpp
\end{itemize}

Week 4 -- Databases

\begin{itemize}
\tightlist
\item
  Lecture 7. Overview of SQL (SQLite, PostgreSQL) and noSQL databases
  (HBase, MongoDB, Cassandra, BigTable, \ldots{})
\item
  Lecture 8. R database interfaces (in particular through dplyr)
\end{itemize}

Week 5 - Analyzing data that does not fit in memory

\begin{itemize}
\tightlist
\item
  Lecture 9. Pure R solutions (sampling, \texttt{ff} and
  \texttt{bigmemory}, other interpreters). JVM solutions (h20, Spark)
\item
  Lecture 10. An introduction to parallel computing; clusters and cloud
  computing. ``Divide and Conquer'' (MapReduce approaches)
\end{itemize}

Week 6 -- Visualization

\begin{itemize}
\tightlist
\item
  Lecture 11. Principles of visualization (guest lecture: James Honaker)
\item
  Lecture 12. Maps and GIS: principles of GIS, using R as a GIS, PostGIS
\end{itemize}

Weeks 7 \& 8 - Guest lectures (order and precise schedule TBD)

\begin{itemize}
\tightlist
\item
  Software project management (Danny Brooke)
\item
  R and Spark (Ellen Kraffmiller and Robert Treacy)
\item
  Advanced GIS and remote sensing (TBD)
\item
  Cluster architecture (William J. Horka)
\end{itemize}

\section{Evaluation}\label{evaluation}

Grades will be based on \textbf{two mandatory problem sets}. Each
problem set will correspond to 50\% (= 50 points) of the final grade.
The first problem set will be available by the end of week 3 and the
second problem set by the end of week 6.

You will be required to submit problem set solutions within two weeks.
Grades, and feedback when appropriate, will be returned two weeks after
submission.

You will submit a markdown document that combines commented code for
data analysis and detailed and structured explanations of the algorithms
and software tools that you used.

\section{Software tools and packages}\label{software-tools-and-packages}

We will mostly use \href{https://www.r-project.org/}{R} in this course.
Some examples will be run in \href{https://www.python.org/}{Python}.

In general, we will use free and open-source software programs such as
\href{https://www.postgresql.org/}{PostgreSQL} /
\href{http://postgis.net/}{PostGIS} or
\href{https://spark.apache.org/}{Spark}.

\section{Datasets}\label{datasets}

We have collected datasets to illustrate concepts. They are hosted on a
\href{https://www.dropbox.com/sh/mt4a7goxsl44swm/AADJK54wOXlDZjABMxN0DJIHa?dl=0}{Dropbox
folder}.

\subsection{MovieLens}\label{movielens}

MovieLens by
\citet[\url{https://grouplens.org/datasets/movielens/}]{Harper2015}
collects datasets from the website \url{https://movielens.org/}.

There are datasets of different sizes. We will use:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Small (1MB): \url{https://grouplens.org/datasets/movielens/latest/}
\item
  Benchmark (\textasciitilde{}190MB zipped):
  \url{https://grouplens.org/datasets/movielens/20m/}
\end{enumerate}

\subsection{Airlines data}\label{airlines-data}

The airlines dataset comes from the U.S. Department of Transportation
and were used in the
\href{http://stat-computing.org/dataexpo/2009/}{2009 Data Expo} of the
American Statistical Association (ASA).

We will use a version curated by \href{https://www.h2o.ai/}{h20o}:
\url{https://github.com/h2oai/h2o-2/wiki/Hacking-Airline-DataSet-with-H2O}.

\subsection{Insurance claims}\label{insurance-claims}

Claims data contain Protected Health Information (PHI). There are strong
privacy restrictions to store, use and share this type of data.

We will use
\href{https://www.cms.gov/Research-Statistics-Data-and-Systems/Downloadable-Public-Use-Files/SynPUFs/DE_Syn_PUF.html}{synthetic
data}
(\href{https://www.cms.gov/Research-Statistics-Data-and-Systems/Downloadable-Public-Use-Files/SynPUFs/DESample01.html}{Sample
1}) from the Centers for Medicare and Medicaid Services (CMS).

\subsection{Census}\label{census}

Census data is commonly merged with administrative claims data such as
Medicare. We will use data from the
\href{https://www.census.gov/data.html}{Census Bureau}.

\subsection{\texorpdfstring{PM\textsubscript{2.5}
exposure}{PM2.5 exposure}}\label{pm2.5-exposure}

We will use PM\textsubscript{2.5} exposure data from the
\href{https://www.epa.gov/aqs}{EPA Air Quality System (AQS)} to
illustrate GIS linkage concepts.

\subsection{Methylation}\label{methylation}

If there is enough interest, we might present methylation examples.

\section{Contributing with GitHub}\label{contributing-with-github}

If you have suggestions, you can open a GitHub issue at
\url{https://github.com/cchoirat/bigdata17/issues}.

If you want to contribute, we welcome
\href{https://help.github.com/articles/about-pull-requests/}{pull
requests}.

\chapter{Basic tools}\label{basics}

In this Chapter, we present basic tools that will be important when
interacting with big data systems, most importantly the command-line
interface (CLI) in a Unix shell and several utilities (\texttt{less},
\texttt{awk}, \texttt{vi} and \texttt{make}).

\section{Command line tools}\label{command-line-tools}

We assume some familiarity with the Unix shell, for example as in
\url{http://swcarpentry.github.io/shell-novice/}.

We also assume that you have access to a shell, either because you use
Linux or OS X or because you have the right tools on Windows (for
example \href{https://www.cygwin.com/}{Cygwin} or the Bash shell in
Windows 10).

\subsection{Why use the command line?}\label{why-use-the-command-line}

\begin{itemize}
\item
  Batch processing
\item
  Cluster and cloud computing
\end{itemize}

\subsection{Basic Unix commands}\label{basic-unix-commands}

\subsection{Useful tools}\label{useful-tools}

\subsubsection{\texorpdfstring{\texttt{less}}{less}}\label{less}

\subsubsection{\texorpdfstring{\texttt{awk}}{awk}}\label{awk}

\subsubsection{\texorpdfstring{\texttt{vi}}{vi}}\label{vi}

\subsection{Example}\label{example}

Let's apply some of the techniques described in \citet{Blackwell2012} on
Fisher's Iris data set saved in tab-delimited format. Of course, it is a
small dataset easily processed with R:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris <-}\StringTok{ }\KeywordTok{read.table}\NormalTok{(}\StringTok{"~/Dropbox/Data17/iris/iris.tab"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(iris, }\DataTypeTok{n =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
\end{verbatim}

In a shell, we can use:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{ -n 6 ~/Dropbox/Data17/iris/iris.tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## "Sepal.Length"   "Sepal.Width"   "Petal.Length"  "Petal.Width"   "Species"
## "1"  5.1 3.5 1.4 0.2 "setosa"
## "2"  4.9 3   1.4 0.2 "setosa"
## "3"  4.7 3.2 1.3 0.2 "setosa"
## "4"  4.6 3.1 1.5 0.2 "setosa"
## "5"  5   3.6 1.4 0.2 "setosa"
\end{verbatim}

Suppose that we only need to select two variables in our model,
\texttt{Sepal.Length} and \texttt{Species}. In R, we can use:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris_subset <-}\StringTok{ }\NormalTok{iris[, }\KeywordTok{c}\NormalTok{(}\StringTok{"Sepal.Length"}\NormalTok{, }\StringTok{"Species"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

or

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris_subset <-}\StringTok{ }\NormalTok{iris[, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{)]}
\KeywordTok{head}\NormalTok{(iris_subset)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length Species
## 1          5.1  setosa
## 2          4.9  setosa
## 3          4.7  setosa
## 4          4.6  setosa
## 5          5.0  setosa
## 6          5.4  setosa
\end{verbatim}

With the tidyverse, we can use \emph{pipes}. The
\texttt{\%\textgreater{}\%} operator allows for performing chained
operations.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{suppressMessages}\NormalTok{(}\KeywordTok{library}\NormalTok{(dplyr))}

\NormalTok{iris }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length Species
## 1          5.1  setosa
## 2          4.9  setosa
## 3          4.7  setosa
## 4          4.6  setosa
## 5          5.0  setosa
## 6          5.4  setosa
\end{verbatim}

In a shell, the pipe operator to combine shell commands is
\texttt{\textbar{}} and we can use:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cut}\NormalTok{ -f 1,5 ~/Dropbox/Data17/iris/iris.tab }\KeywordTok{|} \FunctionTok{head}\NormalTok{ -n 7}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## "Sepal.Length"   "Species"
## "1"  0.2
## "2"  0.2
## "3"  0.2
## "4"  0.2
## "5"  0.2
## "6"  0.4
\end{verbatim}

To keep observations with ``Sepal.Length'' greater than 5:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(Sepal.Length }\OperatorTok{>}\StringTok{ }\DecValTok{5}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          5.4         3.9          1.7         0.4  setosa
## 3          5.4         3.7          1.5         0.2  setosa
## 4          5.8         4.0          1.2         0.2  setosa
## 5          5.7         4.4          1.5         0.4  setosa
## 6          5.4         3.9          1.3         0.4  setosa
\end{verbatim}

In the shell, we can use the \texttt{AWK} programming language. We start
from row \texttt{NR} 2 (we could start from row 1, it contains variable
names) and select rows such that the second variable
(\texttt{Sepal.Length}) is greater than 5.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{awk} \StringTok{'NR == 2 || $2 > 5'}\NormalTok{ ~/Dropbox/Data17/iris/iris.tab }\KeywordTok{|} \FunctionTok{head}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## "1"  5.1 3.5 1.4 0.2 "setosa"
## "6"  5.4 3.9 1.7 0.4 "setosa"
## "11" 5.4 3.7 1.5 0.2 "setosa"
## "15" 5.8 4   1.2 0.2 "setosa"
## "16" 5.7 4.4 1.5 0.4 "setosa"
## "17" 5.4 3.9 1.3 0.4 "setosa"
## "18" 5.1 3.5 1.4 0.3 "setosa"
## "19" 5.7 3.8 1.7 0.3 "setosa"
## "20" 5.1 3.8 1.5 0.3 "setosa"
## "21" 5.4 3.4 1.7 0.2 "setosa"
\end{verbatim}

\BeginKnitrBlock{exercise}
\protect\hypertarget{exr:unnamed-chunk-11}{}{\label{exr:unnamed-chunk-11}
}The iris dataset is also saved in .csv format at
\texttt{\textasciitilde{}/Dropbox/Data17/iris/iris.csv}. Use
\texttt{AWK} and \texttt{tail} to select the last 5 observations where
\texttt{Sepal.Width} is larger than 3.5 and \texttt{Petal.Length} is
smaller than 1.5.
\EndKnitrBlock{exercise}

\section{Makefiles}\label{makefiles}

\texttt{make} is a tool that helps put all the pieces of an analytic
workflow together:

\begin{itemize}
\tightlist
\item
  data retrieving
\item
  data cleaning
\item
  analysis
\item
  graphs
\item
  reports
\item
  \ldots{}
\end{itemize}

Dependency management

\subsection{Simulate data in R}\label{simulate-data-in-r}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

File \texttt{simulate\_data.R}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set.seed(123)}
\NormalTok{N <-}\StringTok{ }\DecValTok{1000} \CommentTok{# sample size}

\NormalTok{X1 <-}\StringTok{ }\KeywordTok{rpois}\NormalTok{(}\DataTypeTok{n =}\NormalTok{ N, }\DataTypeTok{lambda =} \DecValTok{50}\NormalTok{)}
\NormalTok{X2 <-}\StringTok{ }\DecValTok{10} \OperatorTok{+}\StringTok{ }\KeywordTok{rbinom}\NormalTok{(}\DataTypeTok{n =}\NormalTok{ N, }\DataTypeTok{prob =} \FloatTok{0.8}\NormalTok{, }\DataTypeTok{size =} \DecValTok{1}\NormalTok{)}
\NormalTok{Y <-}\StringTok{ }\DecValTok{10} \OperatorTok{+}\StringTok{ }\DecValTok{3} \OperatorTok{*}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\OperatorTok{-}\DecValTok{5} \OperatorTok{*}\StringTok{ }\NormalTok{X2 }\OperatorTok{+}\StringTok{ }\DecValTok{3} \OperatorTok{*}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DataTypeTok{n =}\NormalTok{ N)}

\KeywordTok{write.csv}\NormalTok{(}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Y =}\NormalTok{ Y, }\DataTypeTok{X1 =}\NormalTok{ X1, }\DataTypeTok{X2 =}\NormalTok{ X2),}
          \StringTok{"sample_data.csv"}\NormalTok{, }\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{Y =}\NormalTok{ Y, }\DataTypeTok{X1 =}\NormalTok{ X1, }\DataTypeTok{X2 =}\NormalTok{ X2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Y X1 X2
## 1  88.74430 46 11
## 2 125.77081 58 11
## 3  70.76396 38 10
## 4 110.32157 50 10
## 5 145.79546 62 11
## 6 109.45403 53 11
\end{verbatim}

\subsection{Create a plot in Python}\label{create-a-plot-in-python}

File \texttt{create\_graph.py}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ matplotlib.pyplot }\ImportTok{as}\NormalTok{ plt}

\NormalTok{sim_data }\OperatorTok{=}\NormalTok{ pd.read_csv(}\StringTok{"sample_data.csv"}\NormalTok{)}

\NormalTok{plt.figure()}
\NormalTok{sim_data.plot()}
\NormalTok{plt.savefig(}\StringTok{"plot.pdf"}\NormalTok{, }\BuiltInTok{format} \OperatorTok{=} \StringTok{"pdf"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{images/ch1_plot.jpg}

\subsection{Run statistical model in
R}\label{run-statistical-model-in-r}

We can print the model output with:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim_data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"sample_data.csv"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(}\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{~}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ sim_data))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Y ~ X1 + X2, data = sim_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.3988 -1.9452 -0.0261  2.0216  9.1066 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  9.09087    2.54667    3.57 0.000374 ***
## X1           3.00531    0.01326  226.68  < 2e-16 ***
## X2          -4.94658    0.22876  -21.62  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.936 on 997 degrees of freedom
## Multiple R-squared:  0.9811, Adjusted R-squared:  0.981 
## F-statistic: 2.585e+04 on 2 and 997 DF,  p-value: < 2.2e-16
\end{verbatim}

\subsection{Run statistical model in
R}\label{run-statistical-model-in-r-1}

To save the output, we use the \texttt{sink} function.

File \texttt{estimate\_model.R}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sim_data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{"sample_data.csv"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(}\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{~}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ sim_data))}

\KeywordTok{sink}\NormalTok{(}\StringTok{"estimation_summary.txt"}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(}\KeywordTok{lm}\NormalTok{(Y }\OperatorTok{~}\StringTok{ }\NormalTok{X1 }\OperatorTok{+}\StringTok{ }\NormalTok{X2, }\DataTypeTok{data =}\NormalTok{ sim_data))}
\KeywordTok{sink}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{Makefile syntax}\label{makefile-syntax}

\begin{itemize}
\item
  \texttt{make} is a \emph{command} that runs on a text file often named
  \texttt{Makefile}.
\item
  A \texttt{Makefile} contains one or several blocks with the following
  structure:
\end{itemize}

\begin{verbatim}
targetfile: sourcefile(s)
[tab] command
\end{verbatim}

\subsection{Naive version}\label{naive-version}

File: \texttt{Makefile}

\begin{verbatim}
sample_data.csv: simulate_data.R
    R CMD BATCH simulate_data.R

plot.pdf: create_graph.py
    python create_graph.py

estimation_summary.txt: estimate_model.R
    R CMD BATCH estimate_model.R
\end{verbatim}

A simple call to \texttt{make} only builds the first target
(\texttt{sample\_data.csv}). To build the other targets, we have to use:
\texttt{make\ plot.pdf} and \texttt{make\ estimation\_summary.txt}.

\subsection{Making all targets}\label{making-all-targets}

File: \texttt{Makefile}

\begin{verbatim}
all: analysis

analysis: sample_data.csv plot.pdf estimation_summary.txt

sample_data.csv: simulate_data.R
    R CMD BATCH simulate_data.R

plot.pdf: create_graph.py
    python create_graph.py

estimation_summary.txt: estimate_model.R
    R CMD BATCH estimate_model.R
\end{verbatim}

New data is simulated and saved in \texttt{sample\_data.csv}. But
\texttt{plot.pdf} and \texttt{estimation\_summary.txt} are not updated.

\subsection{Dealing with dependencies}\label{dealing-with-dependencies}

\begin{itemize}
\tightlist
\item
  Problem \texttt{plot.pdf} and \texttt{estimation\_summary.txt} depend
  on \texttt{sample\_data.csv}.
\item
  Solution: explicit dependencies.
\end{itemize}

File: \texttt{Makefile}

\begin{verbatim}
all: analysis

analysis: sample_data.csv plot.pdf estimation_summary.txt

sample_data.csv: simulate_data.R
    R CMD BATCH simulate_data.R

plot.pdf: sample_data.csv create_graph.py
    python create_graph.py

estimation_summary.txt: sample_data.csv estimate_model.R
    R CMD BATCH estimate_model.R
\end{verbatim}

\section{Git and GitHub}\label{git-and-github}

Guest lecture by \href{https://www.iq.harvard.edu/people/ista-zahn}{Ista
Zahn}.

\chapter{Packages}\label{packages}

We strongly recommand \citet{Wickham2015}.

We assume the following packages are installed:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{install.packages}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"devtools"}\NormalTok{, }\StringTok{"roxygen2"}\NormalTok{, }\StringTok{"testthat"}\NormalTok{, }\StringTok{"knitr"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\section{Why?}\label{why}

\begin{itemize}
\item
  Organize your code
\item
  Distribute your code
\item
  Keep versions of your code
\end{itemize}

\section{Package structure}\label{package-structure}

\begin{itemize}
\tightlist
\item
  Folder hierarchy

  \begin{itemize}
  \tightlist
  \item
    \texttt{NAMESPACE}: package import / export
  \item
    \texttt{DESCRIPTION}: metadata
  \item
    \texttt{R/}: R code
  \item
    \texttt{man/}: object documentation (with short examples)
  \item
    \texttt{tests/}
  \item
    \texttt{data/}
  \item
    \texttt{src/}: compiled code
  \item
    \texttt{vignettes/}: manual-like documentation
  \item
    \texttt{inst/}: installed files
  \item
    \texttt{demo/}: longer examples
  \item
    \texttt{exec}, \texttt{po}, \texttt{tools}
  \end{itemize}
\end{itemize}

\section{Building steps}\label{building-steps}

\begin{itemize}
\item
  \texttt{R\ CMD\ build}
\item
  \texttt{R\ CMD\ INSTALL}
\item
  \texttt{R\ CMD\ check}
\end{itemize}

\subsection{\texorpdfstring{\texttt{R\ CMD\ build}}{R CMD build}}\label{r-cmd-build}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{R CMD build }\OperatorTok{--}\NormalTok{help}
\end{Highlighting}
\end{Shaded}

\emph{Build R packages from package sources in the directories specified
by `pkgdirs'}

\subsection{\texorpdfstring{\texttt{R\ CMD\ INSTALL}}{R CMD INSTALL}}\label{r-cmd-install}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{R CMD INSTALL }\OperatorTok{--}\NormalTok{help}
\end{Highlighting}
\end{Shaded}

\emph{Install the add-on packages specified by pkgs. The elements of
pkgs can be relative or absolute paths to directories with the package
sources, or to gzipped package `tar' archives. The library tree to
install to can be specified via `--library'. By default, packages are
installed in the library tree rooted at the first directory in
.libPaths() for an R session run in the current environment.}

\subsection{\texorpdfstring{\texttt{R\ CMD\ check}}{R CMD check}}\label{r-cmd-check}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{R CMD check }\OperatorTok{--}\NormalTok{help}
\end{Highlighting}
\end{Shaded}

\url{http://r-pkgs.had.co.nz/check.html}

\emph{Check R packages from package sources, which can be directories or
package `tar' archives with extension `.tar.gz', `.tar.bz2', `.tar.xz'
or `.tgz'.}

\emph{A variety of diagnostic checks on directory structure, index and
control files are performed. The package is installed into the log
directory and production of the package PDF manual is tested. All
examples and tests provided by the package are tested to see if they run
successfully. By default code in the vignettes is tested, as is
re-building the vignette PDFs.}

\subsection{\texorpdfstring{Building steps with
\texttt{devtools}}{Building steps with devtools}}\label{building-steps-with-devtools}

\begin{itemize}
\item
  \texttt{devtools::build}
\item
  \texttt{devtools::install}
\item
  \texttt{devtools::check}
\item
  and many others: \texttt{load\_all}, \texttt{document}, \texttt{test},
  \texttt{run\_examples}, \ldots{}
\end{itemize}

\section{Create an R package}\label{create-an-r-package}

\subsection{\texorpdfstring{\texttt{utils::package.skeleton}}{utils::package.skeleton}}\label{utilspackage.skeleton}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{package.skeleton}\NormalTok{() }\CommentTok{# "in "clean" session ("anRpackage")}
\KeywordTok{package.skeleton}\NormalTok{(}\StringTok{"pkgname"}\NormalTok{) }\CommentTok{# in "clean" session}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{02138}\NormalTok{)}
\NormalTok{f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y) x}\OperatorTok{+}\NormalTok{y}
\NormalTok{g <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y) x}\OperatorTok{-}\NormalTok{y}
\NormalTok{d <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{a =} \DecValTok{1}\NormalTok{, }\DataTypeTok{b =} \DecValTok{2}\NormalTok{)}
\NormalTok{e <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{)}
\KeywordTok{package.skeleton}\NormalTok{(}\DataTypeTok{list =} \KeywordTok{c}\NormalTok{(}\StringTok{"f"}\NormalTok{,}\StringTok{"g"}\NormalTok{,}\StringTok{"d"}\NormalTok{,}\StringTok{"e"}\NormalTok{), }\DataTypeTok{name =} \StringTok{"pkgname"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{\texttt{devtools::create}}{devtools::create}}\label{devtoolscreate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{create}\NormalTok{(}\StringTok{"path/to/package/pkgname"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Submit to CRAN}\label{submit-to-cran}

\begin{figure}

{\centering \includegraphics{images/ch3_hydra} 

}

\caption{Submittin to CRAN.  It's not that bad...}\label{fig:hydra}
\end{figure}

Reading: \url{http://r-pkgs.had.co.nz/release.html}

\section{R packages on GitHub}\label{r-packages-on-github}

Reading: \url{http://r-pkgs.had.co.nz/git.html}

\begin{itemize}
\item
  Version control
\item
  Website
\item
  Easy install: \texttt{install\_github} from \texttt{devtools}
\item
  Collaboration
\end{itemize}

\subsubsection{RStudio and GitHub
integration}\label{rstudio-and-github-integration}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_1} 

}

\end{figure}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_2} 

}

\end{figure}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_3} 

}

\end{figure}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_4} 

}

\end{figure}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_5} 

}

\end{figure}

\textbf{Command line}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{git init}
\NormalTok{git add }\OperatorTok{*}
\NormalTok{git commit }\OperatorTok{-}\NormalTok{m }\StringTok{"First commit"}
\NormalTok{git remote add origin git}\OperatorTok{@}\NormalTok{github.com}\OperatorTok{:}\NormalTok{harvard}\OperatorTok{-}\NormalTok{P01}\OperatorTok{/}\NormalTok{pkgtemplate.git}
\NormalTok{git push }\OperatorTok{-}\NormalTok{u origin master}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_6} 

}

\end{figure}

\begin{figure}

{\centering \includegraphics{images/ch3_create_git_package_7} 

}

\end{figure}

\subsection{Installing from GitHub}\label{installing-from-github}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"harvard-P01/pkgtemplate"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"harvard-P01/pkgtemplate"}\NormalTok{,}
                         \DataTypeTok{build_vignettes =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{\texttt{.gitignore}}{.gitignore}}\label{gitignore}

RStudio default

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{.Rproj.user}
\NormalTok{.Rhistory}
\NormalTok{.RData}
\end{Highlighting}
\end{Shaded}

GitHub default

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# History files}
\NormalTok{.Rhistory}
\NormalTok{.Rapp.history}

\CommentTok{# Example code in package build process}
\OperatorTok{*-}\NormalTok{Ex.R}

\CommentTok{# RStudio files}
\NormalTok{.Rproj.user}\OperatorTok{/}

\CommentTok{# produced vignettes}
\NormalTok{vignettes}\OperatorTok{/}\ErrorTok{*}\NormalTok{.html}
\NormalTok{vignettes}\OperatorTok{/}\ErrorTok{*}\NormalTok{.pdf}
\end{Highlighting}
\end{Shaded}

\section{RStudio projects}\label{rstudio-projects}

\begin{itemize}
\item
  \texttt{.Rproj} file extension, in our example
  \texttt{pkgtemplate.Rproj}
\item
  A project has its own:

  \begin{itemize}
  \tightlist
  \item
    R session
  \item
    .Rprofile (\emph{e.g.}, to customize startup environment)
  \item
    .Rhistory
  \end{itemize}
\item
  Default working directory is project directory
\item
  Keeps track of project-specific recent files
\end{itemize}

\subsection{Project options}\label{project-options}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Version}\OperatorTok{:}\StringTok{ }\FloatTok{1.0}

\NormalTok{RestoreWorkspace}\OperatorTok{:}\StringTok{ }\NormalTok{Default}
\NormalTok{SaveWorkspace}\OperatorTok{:}\StringTok{ }\NormalTok{Default}
\NormalTok{AlwaysSaveHistory}\OperatorTok{:}\StringTok{ }\NormalTok{Default}

\NormalTok{EnableCodeIndexing}\OperatorTok{:}\StringTok{ }\NormalTok{Yes}
\NormalTok{UseSpacesForTab}\OperatorTok{:}\StringTok{ }\NormalTok{Yes}
\NormalTok{NumSpacesForTab}\OperatorTok{:}\StringTok{ }\DecValTok{2}
\NormalTok{Encoding}\OperatorTok{:}\StringTok{ }\NormalTok{UTF}\OperatorTok{-}\DecValTok{8}

\NormalTok{RnwWeave}\OperatorTok{:}\StringTok{ }\NormalTok{knitr}
\NormalTok{LaTeX}\OperatorTok{:}\StringTok{ }\NormalTok{pdfLaTeX}

\NormalTok{AutoAppendNewline}\OperatorTok{:}\StringTok{ }\NormalTok{Yes}
\NormalTok{StripTrailingWhitespace}\OperatorTok{:}\StringTok{ }\NormalTok{Yes}

\NormalTok{BuildType}\OperatorTok{:}\StringTok{ }\NormalTok{Package}
\NormalTok{PackageUseDevtools}\OperatorTok{:}\StringTok{ }\NormalTok{Yes}
\NormalTok{PackageInstallArgs}\OperatorTok{:}\StringTok{ }\OperatorTok{--}\NormalTok{no}\OperatorTok{-}\NormalTok{multiarch }\OperatorTok{--}\NormalTok{with}\OperatorTok{-}\NormalTok{keep.source}
\end{Highlighting}
\end{Shaded}

\subsection{Package documentation}\label{package-documentation}

\begin{itemize}
\item
  Functions and methods
\item
  Vignettes

  \begin{itemize}
  \tightlist
  \item
    PDF
  \item
    \texttt{knitr} (or \texttt{Sweave})
  \end{itemize}
\end{itemize}

\section{Package workflow example}\label{package-workflow-example}

Creating R Packages: A Tutorial (Friedrich Leisch, 2009)

\begin{itemize}
\tightlist
\item
  \url{https://cran.r-project.org/doc/contrib/Leisch-CreatingPackages.pdf}
\end{itemize}

\subsection{\texorpdfstring{Add \texttt{linreg.R} to \texttt{R/}
directory}{Add linreg.R to R/ directory}}\label{add-linreg.r-to-r-directory}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linmodEst <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  ## compute QR-decomposition of x}
\NormalTok{  qx <-}\StringTok{ }\KeywordTok{qr}\NormalTok{(x)}
\NormalTok{  ## compute (x’x)^(-1) x’y}
\NormalTok{  coef <-}\StringTok{ }\KeywordTok{solve.qr}\NormalTok{(qx, y)}
\NormalTok{  ## degrees of freedom and standard deviation of residuals}
\NormalTok{  df <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(x) }\OperatorTok{-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(x)}
\NormalTok{  sigma2 <-}\StringTok{ }\KeywordTok{sum}\NormalTok{((y }\OperatorTok{-}\StringTok{ }\NormalTok{x }\OperatorTok{%*%}\StringTok{ }\NormalTok{coef) }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{/}\StringTok{ }\NormalTok{df}
\NormalTok{  ## compute sigma^2 * (x’x)^-1}
\NormalTok{  vcov <-}\StringTok{ }\NormalTok{sigma2 }\OperatorTok{*}\StringTok{ }\KeywordTok{chol2inv}\NormalTok{(qx}\OperatorTok{$}\NormalTok{qr)}
  \KeywordTok{colnames}\NormalTok{(vcov) <-}\StringTok{ }\KeywordTok{rownames}\NormalTok{(vcov) <-}\StringTok{ }\KeywordTok{colnames}\NormalTok{(x)}
  \KeywordTok{list}\NormalTok{(}
    \DataTypeTok{coefficients =}\NormalTok{ coef,}
    \DataTypeTok{vcov =}\NormalTok{ vcov,}
    \DataTypeTok{sigma =} \KeywordTok{sqrt}\NormalTok{(sigma2),}
    \DataTypeTok{df =}\NormalTok{ df}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{Run our function}\label{run-our-function}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(cats, }\DataTypeTok{package =} \StringTok{"MASS"}\NormalTok{)}
\KeywordTok{linmodEst}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{, cats}\OperatorTok{$}\NormalTok{Bwt), cats}\OperatorTok{$}\NormalTok{Hwt)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $coefficients
## [1] -0.3566624  4.0340627
## 
## $vcov
##            [,1]        [,2]
## [1,]  0.4792475 -0.17058197
## [2,] -0.1705820  0.06263081
## 
## $sigma
## [1] 1.452373
## 
## $df
## [1] 142
\end{verbatim}

We can compare the output with \texttt{lm}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Hwt }\OperatorTok{~}\StringTok{ }\NormalTok{Bwt, }\DataTypeTok{data=}\NormalTok{cats)}
\NormalTok{lm1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Hwt ~ Bwt, data = cats)
## 
## Coefficients:
## (Intercept)          Bwt  
##     -0.3567       4.0341
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(lm1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## (Intercept)         Bwt 
##  -0.3566624   4.0340627
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vcov}\NormalTok{(lm1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             (Intercept)         Bwt
## (Intercept)   0.4792475 -0.17058197
## Bwt          -0.1705820  0.06263081
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(lm1)}\OperatorTok{$}\NormalTok{sigma}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.452373
\end{verbatim}

\subsection{Add ROxygen2
documentation}\label{add-roxygen2-documentation}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#' Linear regression}
\CommentTok{#'}
\CommentTok{#' Runs an OLS regression not unlike \textbackslash{}code\{\textbackslash{}link\{lm\}\}}
\CommentTok{#'}
\CommentTok{#' @param y response vector (1 x n)}
\CommentTok{#' @param X covariate matrix (p x n) with no intercept}
\CommentTok{#'}
\CommentTok{#' @return A list with 4 elements: coefficients, vcov, sigma, df}
\CommentTok{#'}
\CommentTok{#' @examples}
\CommentTok{#' data(mtcars)}
\CommentTok{#' X <- as.matrix(mtcars[, c("cyl", "disp", "hp")])}
\CommentTok{#' y <- mtcars[, "mpg"]}
\CommentTok{#' linreg(y, X)}
\CommentTok{#'}
\CommentTok{#' @export}
\CommentTok{#'}
\NormalTok{linmodEst <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  ## compute QR-decomposition of x}
\NormalTok{  qx <-}\StringTok{ }\KeywordTok{qr}\NormalTok{(x)}
\NormalTok{  ## compute (x’x)^(-1) x’y}
\NormalTok{  coef <-}\StringTok{ }\KeywordTok{solve.qr}\NormalTok{(qx, y)}
\NormalTok{  ## degrees of freedom and standard deviation of residuals}
\NormalTok{  df <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(x) }\OperatorTok{-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(x)}
\NormalTok{  sigma2 <-}\StringTok{ }\KeywordTok{sum}\NormalTok{((y }\OperatorTok{-}\StringTok{ }\NormalTok{x }\OperatorTok{%*%}\StringTok{ }\NormalTok{coef) }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{/}\StringTok{ }\NormalTok{df}
\NormalTok{  ## compute sigma^2 * (x’x)^-1}
\NormalTok{  vcov <-}\StringTok{ }\NormalTok{sigma2 }\OperatorTok{*}\StringTok{ }\KeywordTok{chol2inv}\NormalTok{(qx}\OperatorTok{$}\NormalTok{qr)}
  \KeywordTok{colnames}\NormalTok{(vcov) <-}\StringTok{ }\KeywordTok{rownames}\NormalTok{(vcov) <-}\StringTok{ }\KeywordTok{colnames}\NormalTok{(x)}
  \KeywordTok{list}\NormalTok{(}
    \DataTypeTok{coefficients =}\NormalTok{ coef,}
    \DataTypeTok{vcov =}\NormalTok{ vcov,}
    \DataTypeTok{sigma =} \KeywordTok{sqrt}\NormalTok{(sigma2),}
    \DataTypeTok{df =}\NormalTok{ df}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{Configure Build Tools}\label{configure-build-tools}

\subsection{\texorpdfstring{\texttt{man/linmodEst.Rd}}{man/linmodEst.Rd}}\label{manlinmodest.rd}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{% Generated by }\KeywordTok{roxygen2}\NormalTok{ (}\FloatTok{4.1}\NormalTok{.}\DecValTok{1}\NormalTok{)}\OperatorTok{:}\StringTok{ }\NormalTok{do not edit by hand}
\NormalTok{% Please edit documentation }\ControlFlowTok{in}\NormalTok{ R}\OperatorTok{/}\NormalTok{linmodEst.R}
\NormalTok{\textbackslash{}name\{linmodEst\}}
\NormalTok{\textbackslash{}alias\{linmodEst\}}
\NormalTok{\textbackslash{}title\{Linear regression\}}
\NormalTok{\textbackslash{}usage\{}
\KeywordTok{linmodEst}\NormalTok{(x, y)}
\NormalTok{\}}
\NormalTok{\textbackslash{}arguments\{}
\NormalTok{\textbackslash{}item\{y\}\{response }\KeywordTok{vector}\NormalTok{ (}\DecValTok{1}\NormalTok{ x n)\}}

\NormalTok{\textbackslash{}item\{X\}\{covariate }\KeywordTok{matrix}\NormalTok{ (p x n) with no intercept\}}
\NormalTok{\}}
\NormalTok{\textbackslash{}value\{}
\NormalTok{A list with }\DecValTok{4}\NormalTok{ elements}\OperatorTok{:}\StringTok{ }\NormalTok{coefficients, vcov, sigma, df}
\NormalTok{\}}
\NormalTok{\textbackslash{}description\{}
\NormalTok{Runs an OLS regression not unlike \textbackslash{}code\{\textbackslash{}link\{lm\}\}}
\NormalTok{\}}
\NormalTok{\textbackslash{}examples\{}
\KeywordTok{data}\NormalTok{(mtcars)}
\NormalTok{X <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(mtcars[, }\KeywordTok{c}\NormalTok{(}\StringTok{"cyl"}\NormalTok{, }\StringTok{"disp"}\NormalTok{, }\StringTok{"hp"}\NormalTok{)])}
\NormalTok{y <-}\StringTok{ }\NormalTok{mtcars[, }\StringTok{"mpg"}\NormalTok{]}
\KeywordTok{linmodEst}\NormalTok{(y, X)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{Formatted output}\label{formatted-output}

\begin{figure}

{\centering \includegraphics{images/ch3_formatted_help} 

}

\end{figure}

\subsection{\texorpdfstring{\texttt{DESCRIPTION}}{DESCRIPTION}}\label{description}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Package}\OperatorTok{:}\StringTok{ }\NormalTok{pkgtemplate}
\NormalTok{Type}\OperatorTok{:}\StringTok{ }\NormalTok{Package}
\NormalTok{Title}\OperatorTok{:}\StringTok{ }\NormalTok{What the Package }\KeywordTok{Does}\NormalTok{ (Title Case)}
\NormalTok{Version}\OperatorTok{:}\StringTok{ }\FloatTok{0.1}
\NormalTok{Date}\OperatorTok{:}\StringTok{ }\DecValTok{2015}\OperatorTok{-}\DecValTok{10}\OperatorTok{-}\DecValTok{24}
\NormalTok{Author}\OperatorTok{:}\StringTok{ }\NormalTok{Who wrote it}
\NormalTok{Maintainer}\OperatorTok{:}\StringTok{ }\NormalTok{Who to complain to }\OperatorTok{<}\NormalTok{yourfault}\OperatorTok{@}\NormalTok{somewhere.net}\OperatorTok{>}
\NormalTok{Description}\OperatorTok{:}\StringTok{ }\NormalTok{More about what it }\KeywordTok{does}\NormalTok{ (maybe more than one line)}
\NormalTok{License}\OperatorTok{:}\StringTok{ }\NormalTok{What license is it under?}
\NormalTok{LazyData}\OperatorTok{:}\StringTok{ }\OtherTok{TRUE}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{\texttt{NAMESPACE}}{NAMESPACE}}\label{namespace}

\texttt{export}'s automatically generated when parsing ROxygen2 snippets

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{export}\NormalTok{(linmodEst)}
\end{Highlighting}
\end{Shaded}

\subsection{S3 basics}\label{s3-basics}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hello <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{() \{}
\NormalTok{ s <-}\StringTok{ "Hello World!"}
 \KeywordTok{class}\NormalTok{(s) <-}\StringTok{ "hi"}
 \KeywordTok{return}\NormalTok{(s)}
\NormalTok{\}}

\KeywordTok{hello}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Hello World!"
## attr(,"class")
## [1] "hi"
\end{verbatim}

\subsection{S3 basics}\label{s3-basics-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{print.hi <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(...) \{}
  \KeywordTok{print}\NormalTok{(}\StringTok{"Surprise!"}\NormalTok{)}
\NormalTok{\}}

\KeywordTok{hello}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Surprise!"
\end{verbatim}

\subsection{S3 and S4 generics}\label{s3-and-s4-generics}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linmod <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, ...)}
  \KeywordTok{UseMethod}\NormalTok{(}\StringTok{"linmod"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linmod.default <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y, ...) \{}
\NormalTok{  x <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(x)}
\NormalTok{  y <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(y)}
\NormalTok{  est <-}\StringTok{ }\KeywordTok{linmodEst}\NormalTok{(x, y)}
\NormalTok{  est}\OperatorTok{$}\NormalTok{fitted.values <-}\StringTok{ }\KeywordTok{as.vector}\NormalTok{(x }\OperatorTok{%*%}\StringTok{ }\NormalTok{est}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{  est}\OperatorTok{$}\NormalTok{residuals <-}\StringTok{ }\NormalTok{y }\OperatorTok{-}\StringTok{ }\NormalTok{est}\OperatorTok{$}\NormalTok{fitted.values}
\NormalTok{  est}\OperatorTok{$}\NormalTok{call <-}\StringTok{ }\KeywordTok{match.call}\NormalTok{()}
  \KeywordTok{class}\NormalTok{(est) <-}\StringTok{ "linmod"}
  \KeywordTok{return}\NormalTok{(est)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{\texttt{print}}{print}}\label{print}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{print.linmod <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, ...) \{}
  \KeywordTok{cat}\NormalTok{(}\StringTok{"Call:}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \KeywordTok{print}\NormalTok{(x}\OperatorTok{$}\NormalTok{call)}
  \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Coefficients:}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \KeywordTok{print}\NormalTok{(x}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\DataTypeTok{Const =} \DecValTok{1}\NormalTok{, }\DataTypeTok{Bwt =}\NormalTok{ cats}\OperatorTok{$}\NormalTok{Bwt)}
\NormalTok{y <-}\StringTok{ }\NormalTok{cats}\OperatorTok{$}\NormalTok{Hw}
\NormalTok{mod1 <-}\StringTok{ }\KeywordTok{linmod}\NormalTok{(x, y)}
\NormalTok{mod1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Call:
## linmod.default(x = x, y = y)
## 
## Coefficients:
##      Const        Bwt 
## -0.3566624  4.0340627
\end{verbatim}

\subsection{Other methods}\label{other-methods}

\begin{itemize}
\item
  \texttt{summary.linmod}
\item
  \texttt{print.summary.linmod}
\item
  \texttt{predict.linmod}
\item
  \texttt{plot.linmod}
\item
  \texttt{coef.linmod}, \texttt{vcov.linmod}, \ldots{}
\end{itemize}

\subsection{Formulas and model frames}\label{formulas-and-model-frames}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{linmod.formula <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(formula, }\DataTypeTok{data =} \KeywordTok{list}\NormalTok{(), ...) \{}
\NormalTok{  mf <-}\StringTok{ }\KeywordTok{model.frame}\NormalTok{(}\DataTypeTok{formula =}\NormalTok{ formula, }\DataTypeTok{data =}\NormalTok{ data)}
\NormalTok{  x <-}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(}\KeywordTok{attr}\NormalTok{(mf, }\StringTok{"terms"}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ mf)}
\NormalTok{  y <-}\StringTok{ }\KeywordTok{model.response}\NormalTok{(mf)}
\NormalTok{  est <-}\StringTok{ }\KeywordTok{linmod.default}\NormalTok{(x, y, ...)}
\NormalTok{  est}\OperatorTok{$}\NormalTok{call <-}\StringTok{ }\KeywordTok{match.call}\NormalTok{()}
\NormalTok{  est}\OperatorTok{$}\NormalTok{formula <-}\StringTok{ }\NormalTok{formula}
  \KeywordTok{return}\NormalTok{(est)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\section{Unit testing}\label{unit-testing}

\subsection{\texorpdfstring{Unit tests and
\texttt{testthat}}{Unit tests and testthat}}\label{unit-tests-and-testthat}

\url{http://r-pkgs.had.co.nz/tests.html}

In package directory:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{use_testthat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

pre-populates \texttt{test/testthat/}

Test files should start with \texttt{test} to be processed.

\subsection{\texorpdfstring{\texttt{test\_coef.R}}{test\_coef.R}}\label{test_coef.r}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(cats, }\DataTypeTok{package =} \StringTok{"MASS"}\NormalTok{)}
\NormalTok{l1 <-}\StringTok{ }\KeywordTok{linmod}\NormalTok{(Hwt }\OperatorTok{~}\StringTok{ }\NormalTok{Bwt }\OperatorTok{*}\StringTok{ }\NormalTok{Sex, }\DataTypeTok{data =}\NormalTok{ cats)}
\NormalTok{l2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Hwt }\OperatorTok{~}\StringTok{ }\NormalTok{Bwt }\OperatorTok{*}\StringTok{ }\NormalTok{Sex, }\DataTypeTok{data =}\NormalTok{ cats)}

\KeywordTok{test_that}\NormalTok{(}\StringTok{"same estimated coefficients as lm function"}\NormalTok{, \{}
  \KeywordTok{expect_equal}\NormalTok{(l1}\OperatorTok{$}\NormalTok{coefficients, l2}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{==}\ErrorTok{>}\StringTok{ }\NormalTok{devtools}\OperatorTok{::}\KeywordTok{test}\NormalTok{()}

\NormalTok{Loading pkgtemplate}
\NormalTok{Loading required package}\OperatorTok{:}\StringTok{ }\NormalTok{testthat}
\NormalTok{Testing pkgtemplate}
\NormalTok{.}
\NormalTok{Woot}\OperatorTok{!}\StringTok{ }
\end{Highlighting}
\end{Shaded}

\section{Code coverage}\label{code-coverage}

\section{Continuous integration}\label{continuous-integration}

\section{Vignettes}\label{vignettes}

\url{http://r-pkgs.had.co.nz/vignettes.html}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\OperatorTok{::}\KeywordTok{use_vignette}\NormalTok{(}\StringTok{"linmod"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\url{https://github.com/harvard-P01/pkgtemplate/blob/master/vignettes/linmod.Rmd}

\chapter{Optimization}\label{optimization}

In this Chapter, we will see how to measure and improve code
performance.

\section{Measuring performance}\label{measuring-performance}

\subsection{Profiling}\label{profiling}

\subsection{Benchmarking}\label{benchmarking}

\section{Improving performance}\label{improving-performance}

\subsection{Introduction to C/C++}\label{introduction-to-cc}

\subsection{Rcpp}\label{rcpp}

\chapter{Databases}\label{databases}

\section{Overview}\label{overview}

\section{SQL}\label{sql}

\section{noSQL}\label{nosql}

\section{R interfaces}\label{r-interfaces}

\chapter{Big data}\label{bigdata}

In this Chapter, we are going to review different approaches to handle
and perform analyses on \emph{data that does not fit in memory}.

\section{Reading big data (that fits in
memory)}\label{reading-big-data-that-fits-in-memory}

\subsection{R package comparison}\label{r-package-comparison}

\subsection{Python}\label{python}

\section{Sampling (can be read, not analyzed
easily)}\label{sampling-can-be-read-not-analyzed-easily}

\section{Pure R solutions}\label{pure-r-solutions}

\section{JVM solutions}\label{jvm-solutions}

\subsection{h20}\label{h20}

\subsection{Spark}\label{spark}

\chapter{Visualization}\label{visualization}

\section{Principles of visualization}\label{principles-of-visualization}

\section{Maps and GIS}\label{maps-and-gis}

\bibliography{packages.bib,book.bib}


\end{document}
